<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>Startshineye的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="毕业于石大，相信技术可以改变人与人之间的生活，码农一枚">
<meta property="og:type" content="website">
<meta property="og:title" content="Startshineye的博客">
<meta property="og:url" content="https://github.com/startshineye/page/2/index.html">
<meta property="og:site_name" content="Startshineye的博客">
<meta property="og:description" content="毕业于石大，相信技术可以改变人与人之间的生活，码农一枚">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Startshineye的博客">
<meta name="twitter:description" content="毕业于石大，相信技术可以改变人与人之间的生活，码农一枚">
  
    <link rel="alternative" href="/atom.xml" title="Startshineye的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <script src="/style.js"></script>
  

</head>

<body>
  <div id="container">
    <div class="left-col">
      <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			 <img src="https://raw.githubusercontent.com/startshineye/img/master/2017/king.jpg" class="js-avatar show">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Startshineye</a></h1>
		</hgroup>

		
		<p class="header-subtitle">淡泊明志，宁静致远</p>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
				<li><a href="/archives">所有文章</a></li>
	        
				<li><a href="/tags/随笔">随笔</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
	        
    		
    			
    			<a class="js-smart-menu" data-idx="0" href="javascript:void(0)">所有文章</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="1" href="javascript:void(0)">标签</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="2" href="javascript:void(0)">友链</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="3" href="javascript:void(0)">关于我</a>
    			
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="https://github.com/startshineye" title="github">github</a>
		        
					<a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
		        
					<a class="rss" target="_blank" href="#" title="rss">rss</a>
		        
					<a class="zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
		        
					<a class="mail" target="_blank" href="#" title="mail">mail</a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"><i class="icon-list"></i></div>
  		<h1 class="header-author js-mobile-header hide">Startshineye</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img src="https://raw.githubusercontent.com/startshineye/img/master/2017/king.jpg" class="js-avatar show">
				
			</div>
			<hgroup>
			  <h1 class="header-author">Startshineye</h1>
			</hgroup>
			
			<p class="header-subtitle">淡泊明志，宁静致远</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
					<li><a href="/tags/随笔">随笔</a></li>
		        
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/startshineye" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
			        
						<a class="rss" target="_blank" href="#" title="rss">rss</a>
			        
						<a class="zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
			        
						<a class="mail" target="_blank" href="#" title="mail">mail</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
        
  
    <article id="post-work-11-nginx安装配置https" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/31/work-11-nginx安装配置https/">work-11-nginx安装配置https</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>参考1:<a href="https://www.cnblogs.com/wanghuaijun/p/5480554.html" target="_blank" rel="external">https://www.cnblogs.com/wanghuaijun/p/5480554.html</a><br>参考2:<a href="https://www.runoob.com/linux/nginx-install-setup.html" target="_blank" rel="external">https://www.runoob.com/linux/nginx-install-setup.html</a>  </p>
<h3 id="安装nginx"><a href="#安装nginx" class="headerlink" title="安装nginx"></a>安装nginx</h3><p>软件需求:<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/63.png" alt=""><br>下载地址:<br>链接：<a href="https://pan.baidu.com/s/1OTFCGaTXOEQ54cnMtv8JJw" target="_blank" rel="external">https://pan.baidu.com/s/1OTFCGaTXOEQ54cnMtv8JJw</a><br>提取码：z3h5 </p>
<h4 id="1-创建nginx用户"><a href="#1-创建nginx用户" class="headerlink" title="1.创建nginx用户"></a>1.创建nginx用户</h4><ol>
<li>1.groupadd -r nginx</li>
<li>2.useradd -r -g nginx -M nginx  </li>
</ol>
<h4 id="2-解压缩nginx的源码并安装"><a href="#2-解压缩nginx的源码并安装" class="headerlink" title="2.解压缩nginx的源码并安装"></a>2.解压缩nginx的源码并安装</h4><ol>
<li>1.nginx-1.10.2.tar.gz、pcre-8.33.tar.gz、zlib-1.2.8.tar.gz上传文件到tools目录  </li>
<li>2.解压:<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/64.png" alt="">  </li>
<li><p>3.cd nginx-1.10.2 执行:configure  </p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">./configure --user=nginx --group=nginx --prefix=/founder/tools/nginx --with-http_stub_status_module --with-http_ssl_module</div><div class="line">--with-http_realip_module --with-http_addition_module --with-pcre=/founder/tools/pcre-8.33 --with-zlib=/founder/tools/zlib-1.2.8</div></pre></td></tr></table></figure>
</li>
<li><p>4.编译  make &amp;&amp; make install<br>如果出现以下错误按照要求修改即可:<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/08/01.png" alt="">   </p>
</li>
<li><p>5.查看nginx版本<br>进入前面configure中配置的prefix下,执行如下命令: </p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./nginx/sbin/nginx -v</div></pre></td></tr></table></figure>
</li>
<li><p>6.启动nginx  </p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./nginx/sbin/nginx</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="2-配置https"><a href="#2-配置https" class="headerlink" title="2.配置https"></a>2.配置https</h3><h4 id="2-1-配置前需要准备"><a href="#2-1-配置前需要准备" class="headerlink" title="2.1 配置前需要准备"></a>2.1 配置前需要准备</h4><ol>
<li>1.配置前需要准备：域名、私钥文件、key文件、密码文件。如下图:<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/08/03.png" alt="">  </li>
</ol>
<h5 id="2-2-开始配置"><a href="#2-2-开始配置" class="headerlink" title="2.2 开始配置"></a>2.2 开始配置</h5><ol>
<li>1.安装证书<br>将证书置于服务器中，一般放于<code>/nginx/sslcrt</code>下。  </li>
<li><p>2.修改配置文件<br>早期的配置文件是<code>/opt/nginx/conf/nginx.conf</code>，较新的项目是<code>/opt/nginx/conf.d/*.conf</code><br>找到需要添加https的服务所在的位置。进行如下配置：<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/08/04.png" alt=""></p>
</li>
<li><p>3.重载nginx配置文件<br>/nginx/sbin/nginx -s reload</p>
</li>
</ol>
<h3 id="3-nginx常见错误"><a href="#3-nginx常见错误" class="headerlink" title="3.nginx常见错误"></a>3.nginx常见错误</h3><ol>
<li>1.解决nginx: [error] open() ＂/usr/local/nginx/logs/nginx.pid＂ failed错误<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/08/02.png" alt="">  </li>
</ol>
<h3 id="4-nginx其他命令"><a href="#4-nginx其他命令" class="headerlink" title="4.nginx其他命令"></a>4.nginx其他命令</h3><p>以下包含了 Nginx 常用的几个命令：</p>
<ol>
<li>1./usr/local/webserver/nginx/sbin/nginx -s reload            # 重新载入配置文件</li>
<li>2./usr/local/webserver/nginx/sbin/nginx -s reopen            # 重启 Nginx</li>
<li>3./usr/local/webserver/nginx/sbin/nginx -s stop              # 停止 Nginx</li>
</ol>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2019/07/31/work-11-nginx安装配置https/" class="archive-article-date">
  	<time datetime="2019-07-31T06:59:33.000Z" itemprop="datePublished"><i class="icon-clock"></i>2019-07-31</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/work/">work</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-ElasticStack-4-倒排索引与分词" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/30/ElasticStack-4-倒排索引与分词/">ElasticStack-4-倒排索引与分词</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="1-书的目录与索引"><a href="#1-书的目录与索引" class="headerlink" title="1.书的目录与索引"></a>1.书的目录与索引</h3><h4 id="1-1-书的索引"><a href="#1-1-书的索引" class="headerlink" title="1.1 书的索引"></a>1.1 书的索引</h4><p>我们通过书的目录里面的章节和对应的页码、我们能很快查询到我们想要知道的信息。<br>那我们如果查找”ACID” 关键词所在的页面？因为这个关键词在目录里面是没有的。一般我们是查询不到的、但是有些数据针对于一些的关键词做了索引。<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/51.png" alt=""><br>以此我们能很快定位到我们需要查找的ACID、</p>
<h4 id="1-2书与搜索引擎"><a href="#1-2书与搜索引擎" class="headerlink" title="1.2书与搜索引擎"></a>1.2书与搜索引擎</h4><p>书和搜索引擎是类似的、书的目录页对应的是正排索引、书的索引页对应的是倒排索引  </p>
<ol>
<li>1.正排索引<br>-文档Id到文档内容、单词的关联关系  </li>
<li>2.倒排索引  </li>
</ol>
<ul>
<li>单词到文档id的关联关系  </li>
</ul>
<h3 id="2-正排与倒排索引简介"><a href="#2-正排与倒排索引简介" class="headerlink" title="2.正排与倒排索引简介"></a>2.正排与倒排索引简介</h3><ol>
<li>1.正排索引<br>-文档id到文档内容、单词的关联关系。<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/52.png" alt=""><br>上面表格代表的是3个文档、他们的id分别是1、2、3内容是右边对应的信息。正排索引我们通过1、2、3可以获取到右边的东西  </li>
<li>2.倒排索引<br>-单词到文档id的关联关系<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/53.png" alt="">   </li>
<li>3.正排索引转换到倒排索引<br>如下是通过正排索引转换到倒排索引，之间通过了分词做了转换。<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/54.png" alt=""> </li>
<li>4.倒排索引-查询流程<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/55.png" alt="">  </li>
</ol>
<h3 id="3-倒排索引详解"><a href="#3-倒排索引详解" class="headerlink" title="3.倒排索引详解"></a>3.倒排索引详解</h3><ol>
<li><p>1.倒排索引是搜索引擎的核心、主要包含两部分:<br>-单词词典(Term Dictionary)<br>-倒排列表(Posting List)  </p>
</li>
<li><p>2.单词词典(Term Dictionary)是倒排索引的重要组成<br>-记录所有文档的单词、一般都比较大<br>-记录单词到倒排列表的关联信息  </p>
</li>
<li><p>3.单词字典的实现一般是用B+Tree,实例如下图:<br>-下图排序采用拼音实现,构造方法参见如下网址:<br>-<a href="https://www.cs.usfca.edu/~galles/visualization/BPlusTree.html" target="_blank" rel="external">https://www.cs.usfca.edu/~galles/visualization/BPlusTree.html</a><br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/56.png" alt=""><br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/57.png" alt=""><br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/58.png" alt=""><br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/59.png" alt=""><br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/60.png" alt="">  </p>
</li>
</ol>
<h3 id="4-分词介绍"><a href="#4-分词介绍" class="headerlink" title="4.分词介绍"></a>4.分词介绍</h3><ol>
<li>1.分词是指将文本转换成一系列单词(term or token)的过程，也可以叫文本分析，在es里面称为Analysis,如下图所示:<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/61.png" alt="">   </li>
<li>2.es中负责分词的组件叫做分词器。分词器是es中专门处理分词的组件,英文名字为Analyzer,由3个部分组成。它的组成如下:  </li>
</ol>
<ul>
<li>Character Filter:针对原始文本进行处理,比如去除html特殊标记符。</li>
<li>Tokenizer:将原始文本按照一定规则切分为单词。  </li>
<li>Token Filters:针对tokenizer处理的单词进行再加工，比如转小写、删除或新增等处理。  </li>
</ul>
<ol>
<li>3.分词器-调用顺序<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/62.png" alt="">  </li>
</ol>
<h3 id="5-Analyze-API"><a href="#5-Analyze-API" class="headerlink" title="5.Analyze API"></a>5.Analyze API</h3><p>我们必须要重视此api、并且要非常熟练使用此api;<br>原因是我们使用es去做搜索时候；发现搜索的关键词返回的结果和预期的不一样，你如何排查这个问题?此时就需要使用Analyze API </p>
<ol>
<li>1.ES通过Analyze 提供了一个测试分词的api接口，endpoint是_analyze<br>-可以直接指定analyzer进行测试<br>-可以直接指定索引中的字段进行测试<br>-可以自定义分词器进行测试  </li>
</ol>
<p>以下我们分别针对上面3种情况进行分析  </p>
<h4 id="5-1-直接指定analyzer进行测试"><a href="#5-1-直接指定analyzer进行测试" class="headerlink" title="5.1 直接指定analyzer进行测试"></a>5.1 直接指定analyzer进行测试</h4><ol>
<li><p>1.token指代分词结果，endpoint是_analyze<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/08/5.png" alt=""><br>kibana下Dev Tools<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/08/6.png" alt="">  </p>
</li>
<li><p>2.直接指定索引中的字段进行测试:当我们已经创建好了索引、针对某个字段去做查询的时候、输出与我预期的不一样、此时我们可以针对这个字段去测试一下。<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/08/7.png" alt=""><br>kibana下Dev Tools<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/08/8.png" alt="">  </p>
</li>
<li><p>3.自定义分词器进行测试:<br>我们之前讲到了分词器的组成部分：Character Filter、Tokenizer、Token Filters这三个部分我们自己去定义，按照自己的要求。定义不同组件、拼成自己的一个分词器。<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/08/9.png" alt=""><br>kibana下Dev Tools<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/08/10.png" alt=""> </p>
</li>
</ol>
<h3 id="6-ES中自带分析器"><a href="#6-ES中自带分析器" class="headerlink" title="6.ES中自带分析器"></a>6.ES中自带分析器</h3><p>es提供了一些默认的分词器:比如：<br>-Standard<br>-Simple<br>-Whitespace<br>-Stop<br>-Keyword<br>-Pattern<br>-Language<br>下面我们将一一解释下各个分析器。  </p>
<h4 id="6-1-Standard"><a href="#6-1-Standard" class="headerlink" title="6.1 Standard"></a>6.1 Standard</h4><p><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/08/11.png" alt=""><br>以上我们以：”The 2 QUICK Brown-Foxes jumped over the lazy dog’s bone”输入<br>经过标准的Analyzer分词器后，输出结果为:<br>[the,2,quick,brown,foxes,jumped,over,the,lazy,dog’s,bone]<br>kibana下Dev Tools<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/08/13.png" alt="">  </p>
<h4 id="6-2-Simple"><a href="#6-2-Simple" class="headerlink" title="6.2 Simple"></a>6.2 Simple</h4><p><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/08/12.png" alt=""> </p>
<h4 id="6-3-Whitespace"><a href="#6-3-Whitespace" class="headerlink" title="6.3 Whitespace"></a>6.3 Whitespace</h4><p><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/08/14.png" alt="">  </p>
<h4 id="6-4-Stop"><a href="#6-4-Stop" class="headerlink" title="6.4 Stop"></a>6.4 Stop</h4><p><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/08/15.png" alt="">  </p>
<h4 id="6-5-Keyword"><a href="#6-5-Keyword" class="headerlink" title="6.5 Keyword"></a>6.5 Keyword</h4><p><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/08/16.png" alt=""><br>不分词，只有一个token。当你不想对这个文本进行分词就用keyword  </p>
<h4 id="6-6-Pattern"><a href="#6-6-Pattern" class="headerlink" title="6.6 Pattern"></a>6.6 Pattern</h4><p><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/08/17.png" alt=""></p>
<h4 id="6-7-Language"><a href="#6-7-Language" class="headerlink" title="6.7 Language"></a>6.7 Language</h4><p><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/08/18.png" alt="">  </p>
<h3 id="7-中文分词"><a href="#7-中文分词" class="headerlink" title="7.中文分词"></a>7.中文分词</h3><ol>
<li>1.难点<br>-中文分词指的是将一个汉字序列切分成一个一个单独的词。在英文中，单词之间是以空格作为自然分界符，汉语中词没有一个形式上的分界符。<br>-上下文不同，分词结果迥异，比如交叉歧义问题，比如下面两种分词都合理:<br>a.乒乓球拍/卖/完了<br>b.乒乓球/拍卖/完了  </li>
</ol>
<p>-<a href="https://mp.weixin.qq.com/s/SiHSMrn8lxCmrtHbcwL-NQ" target="_blank" rel="external">https://mp.weixin.qq.com/s/SiHSMrn8lxCmrtHbcwL-NQ</a>  </p>
<ol>
<li>2.常见分析系统<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/08/19.png" alt="">  </li>
<li>3.基于自然语言处理的分词系统<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/08/20.png" alt="">  </li>
</ol>
<h3 id="8-自定义分词之CharacterFilter"><a href="#8-自定义分词之CharacterFilter" class="headerlink" title="8.自定义分词之CharacterFilter"></a>8.自定义分词之CharacterFilter</h3><ol>
<li>当自带的分词无法满足需求时,可以自定义分词<br>-通过自定义Character Filter、Tokenizer、Token Filters实现。</li>
</ol>
<h4 id="8-1-分词器各组成"><a href="#8-1-分词器各组成" class="headerlink" title="8.1 分词器各组成"></a>8.1 分词器各组成</h4><ol>
<li>1.Character Filters<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/08/21.png" alt="">  </li>
<li>2.Character Filters采用如下api<br>如果需要测试一下Character Filters,api还是_analyze,但是tokenizer需要设置成keyword不进行分词、直接看经过经过Character Filters输出的结果是什么？<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/08/22.png" alt="">  </li>
</ol>
<h3 id="9-自定义分词之Tokenizer"><a href="#9-自定义分词之Tokenizer" class="headerlink" title="9.自定义分词之Tokenizer"></a>9.自定义分词之Tokenizer</h3><ol>
<li><p>1.Tokenizer<br>-将原始文本按照一定规则切分为单词(term or token)<br>-自带的如下:<br>a.standard 按照单词进行分割<br>b.letter按照非字符类进行分割<br>c.whitespace按照空格进行分割<br>d.UAX URL Email按照standard分割，但不会分割邮箱和url<br>e.NGram和Edge NGram连词分割<br>f.Path_Hierarchy按照文件路径进行切割  </p>
</li>
<li><p>2.Tokenizer测试时可以采用如下api<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/08/23.png" alt="">   </p>
</li>
</ol>
<h3 id="10-自定义分词之TokenFilter"><a href="#10-自定义分词之TokenFilter" class="headerlink" title="10.自定义分词之TokenFilter"></a>10.自定义分词之TokenFilter</h3><ol>
<li><p>1.Token Filter<br>-对于tokenizer输出的单词(term)进行增加、删除、修改等操作<br>-自带的如下:<br>a.lowercase将所有term转为小写<br>b.stop删除stop words<br>c.NGram和Edge NGram连词分割<br>d.Synonym添加近义词的term  </p>
</li>
<li><p>2.TokenFilter测试时可以采用如下api<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/08/24.png" alt="">   </p>
</li>
</ol>
<h3 id="11-自定义分词"><a href="#11-自定义分词" class="headerlink" title="11.自定义分词"></a>11.自定义分词</h3><ol>
<li><p>1.自定义分词<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/08/25.png" alt="">  </p>
</li>
<li><p>2.自定义分词-示例<br>示例一:<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/08/26.png" alt=""><br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/08/27.png" alt=""><br>示例二:<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/08/28.png" alt="">  </p>
</li>
</ol>
<h3 id="12-分词使用说明"><a href="#12-分词使用说明" class="headerlink" title="12.分词使用说明"></a>12.分词使用说明</h3><ol>
<li>1.分词会在如下两个手机使用:<br>-创建或更新文档时(Index Time),会对相应的文档进行分词处理。<br>-查询时(Search Time),会对查询语句进行分词。</li>
</ol>
<h4 id="12-1索引时分词"><a href="#12-1索引时分词" class="headerlink" title="12.1索引时分词"></a>12.1索引时分词</h4><ol>
<li>1.索引时分词是通过设置Index Mapping中每个字段的analyzer属性实现的，如下:<br>a.不指定分词时，使用默认standard<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/08/29.png" alt="">  </li>
</ol>
<h4 id="12-2查询时分词"><a href="#12-2查询时分词" class="headerlink" title="12.2查询时分词"></a>12.2查询时分词</h4><ol>
<li>1.查询时分词的指定方式有如下几种:<br>-查询的时候通过analyzer指定分词器<br>-通过index mapping设置search_analyzer实现<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/08/30.png" alt="">  </li>
<li>2.一般不需要特别指定查询时分词器，直接使用索引时分词器即可，否则会出现无法匹配情况。  <h4 id="12-3-分词的使用建议"><a href="#12-3-分词的使用建议" class="headerlink" title="12.3 分词的使用建议"></a>12.3 分词的使用建议</h4></li>
<li>1.明确字段是否需要分词，不需要分词的字段就将type设置为keyword,可以节空间和提高性能。  </li>
<li>善用_anaylzer API,查看文档的具体分词结果。  </li>
<li>动手测试。  </li>
</ol>
<h3 id="13-官方文档说明"><a href="#13-官方文档说明" class="headerlink" title="13.官方文档说明"></a>13.官方文档说明</h3><p>我们想要更多的了解analyzer时候就只需要去官方文档查询</p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2019/07/30/ElasticStack-4-倒排索引与分词/" class="archive-article-date">
  	<time datetime="2019-07-30T15:08:50.000Z" itemprop="datePublished"><i class="icon-clock"></i>2019-07-30</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ElasticStack/">ElasticStack</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-freeswitch-1-使用FreeSWITCH-SIP落地的配置总结" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/29/freeswitch-1-使用FreeSWITCH-SIP落地的配置总结/">freeswitch-1-使用FreeSWITCH SIP落地的配置总结</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>参考:<a href="https://blog.csdn.net/liyang051/article/details/46739639" target="_blank" rel="external">https://blog.csdn.net/liyang051/article/details/46739639</a>  </p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2019/07/29/freeswitch-1-使用FreeSWITCH-SIP落地的配置总结/" class="archive-article-date">
  	<time datetime="2019-07-29T15:47:43.000Z" itemprop="datePublished"><i class="icon-clock"></i>2019-07-29</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/freeswitch/">freeswitch</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-ipcc-2-常见问题记录" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/29/ipcc-2-常见问题记录/">ipcc-2-常见问题记录</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="1-ipcc对接第三方话务平台"><a href="#1-ipcc对接第三方话务平台" class="headerlink" title="1.ipcc对接第三方话务平台"></a>1.ipcc对接第三方话务平台</h4><h5 id="1-1抓包找不到对应ip数据包"><a href="#1-1抓包找不到对应ip数据包" class="headerlink" title="1.1抓包找不到对应ip数据包"></a>1.1抓包找不到对应ip数据包</h5><ol>
<li>1.分析:ipcc对接第三方话务平台的时候、我们抓包时候压根抓不到对应的ip网络交互、说明ipcc没能和第三方话务平台建立链接、说明freeswitch的sip对接地址注册有问题  </li>
<li>2.解决:a.查看对应的网关对接信息是否有问题,在freeswitch的/usr/local/freeswitch/conf/sip_profiles/external/gw5.xml配置<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/35.png" alt="">  </li>
<li>3.解决:b.查看freeswitch启动时候日志信息:<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/36.png" alt=""><br>从上面看是gw5.xml网关对应的配置信息有误  </li>
<li>4.解决:c.打开fs的客户端fs_cli通过sofia status 查看网关注册状态<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/37.png" alt=""><br>从上面可以知道网关注册失败  </li>
</ol>
<p>综上:找相关人员再次获取相关信息。</p>
<h5 id="1-2-fs通过mrcp对接asr时候对接不上"><a href="#1-2-fs通过mrcp对接asr时候对接不上" class="headerlink" title="1.2.fs通过mrcp对接asr时候对接不上"></a>1.2.fs通过mrcp对接asr时候对接不上</h5><p>在测试环境下fs通过mrcp对接asr时候对接时候、启动fs和ipcc平台时候、发现和机器人交互时候总是感觉机器人获取不到用户说话的声音并且抓包时候也没有抓到包<br>解决: </p>
<ol>
<li>1.查看asr的配置信息并确认没问题<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/38.png" alt="">  </li>
<li>2.查看fs的启动日志:然后查看端口信息、发现端口被占用<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/39.png" alt=""><br>综上:杀掉端口对应进程、然后重启即可。</li>
</ol>
<h4 id="2-ipcc通话录音不存在"><a href="#2-ipcc通话录音不存在" class="headerlink" title="2.ipcc通话录音不存在"></a>2.ipcc通话录音不存在</h4><h5 id="2-1-现象"><a href="#2-1-现象" class="headerlink" title="2.1 现象"></a>2.1 现象</h5><p>gs在拨打电话测试时候,测试时候交互都很正常,但是在拨打完听录音时候出现:<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/08/184.png" alt=""><br>HTTP Status 404-<br>/record/ivrrecord2/20190820/10/42/90043811800411.wav</p>
<h5 id="2-2-排查"><a href="#2-2-排查" class="headerlink" title="2.2 排查"></a>2.2 排查</h5><ol>
<li><p>1.查询服务器磁盘录音是否存在<br>-进入/cc/data/ivrrecord2/20190820/10目录下确实没有此文件<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/08/185.png" alt="">  </p>
</li>
<li><p>2.查看fsg日志<br>fsg是freeswitch和ag进行交互的枢纽,所以fsg日志里面会记录相关的日志信息,fsg的日志文件在/cc/bin/log下:log0819060907.log<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/08/186.png" alt=""><br>从上面我们知道fsg和freeswitch已经断开过连接,然后重新建立了连接。  </p>
</li>
</ol>
<p>我们在查看freeswitch.log知道:丢失了很多交互信息<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/08/187.png" alt="">  </p>
<ol>
<li>3.查看fsg.cfg的配置<br>从配置中我们知道连接的freeswitch是127.0.0.1,对应的录音文件是:/cc/data<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/08/188.png" alt=""><br>说明在连接本地freeswitch的时候,也出现了网络抖动问题。  </li>
</ol>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2019/07/29/ipcc-2-常见问题记录/" class="archive-article-date">
  	<time datetime="2019-07-29T08:29:04.000Z" itemprop="datePublished"><i class="icon-clock"></i>2019-07-29</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ipcc/">ipcc</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-work-10-linux下硬盘分区挂载" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<p>title: work-10-linux下硬盘分区挂载<br>date: 2019-07-29 13:52:20<br>tags:</p>
<h2 id="linux"><a href="#linux" class="headerlink" title=" linux"></a> linux</h2><p><a href="https://blog.csdn.net/ren_19891209/article/details/79375495" target="_blank" rel="external">https://blog.csdn.net/ren_19891209/article/details/79375495</a></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2019/07/29/work-10-linux下硬盘分区挂载/" class="archive-article-date">
  	<time datetime="2019-07-29T05:52:20.594Z" itemprop="datePublished"><i class="icon-clock"></i>2019-07-29</time>
</a>
      
      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-ElasticStack-3-Elasticsearch篇之入门" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/18/ElasticStack-3-Elasticsearch篇之入门/">ElasticStack-3-Elasticsearch篇之入门</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="1-术语介绍"><a href="#1-术语介绍" class="headerlink" title="1.术语介绍"></a>1.术语介绍</h3><ol>
<li><p>1.文档 Document<br>用户存储在es中的数据文档—–Mysql中表的一行数据  </p>
</li>
<li><p>2.索引 Index<br>由具有相同字段的文档列表组成(文档集合)—Mysql中的表table<br>在es1.6之前一个index下可以创建多个type、但是1.6之后一个index下只能创建一个type。  </p>
</li>
<li><p>3.节点Node<br>一个Elasticsearch的运行实例，是集群的构成单元。  </p>
</li>
<li><p>4.集群 Cluster<br>由一个或多个节点组成、对外提供服务。  </p>
</li>
</ol>
<h3 id="2-Document介绍"><a href="#2-Document介绍" class="headerlink" title="2.Document介绍"></a>2.Document介绍</h3><ol>
<li>1.Document是一个Json Object,由字段(Field)组成，常见数据类型如下:<br>-字符串:text(分词),keyword(不分词)<br>-数值型:long,integer,short,byte,double,float,half_float,scaled_float(不同类型占用空间不一致)<br>-布尔型:boolean<br>-日期:date<br>-二进制:binary<br>-范围类型:integer_range、float_range、long_range、double_range<br>、date_range  </li>
<li>2.每个文档有唯一的id标识(类似于Mysql中的主键)<br>-可以自动指定<br>-如果不指定、es会自动生成  </li>
</ol>
<p>例如:<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/34.png" alt=""><br>1.上面是nginx的日志:日志包含ip、时间、请求方式、相应等<br>2.下面是es总存放的nginx日志的结构化数据、其就是一个文档  </p>
<ol>
<li>3.一个document有对应的元数据，用于标注文档的相关信息。<br>-_index:文档所在的索引名<br>-_type:文档所在的类型名<br>-_id:文档唯一id<br>-_uid:组合id,由_type和_id组成(6.x_type不再起作用,同_id一样)<br>-_source:文档的原始Json数据、可以从这里获取每个字段的内容<br>-_all:整合所有字段内容到字段，默认禁用  </li>
</ol>
<h3 id="3-Index介绍"><a href="#3-Index介绍" class="headerlink" title="3.Index介绍"></a>3.Index介绍</h3><ol>
<li>1.Index在数据库中类比的概念是:table,我们知道table有自己的scheme(表结构定义)、对应的在es里面、每一个Index都有自己的Scheme定义、他叫Mapping,用于定义定义字段名和类型</li>
<li>2.Index:具有相同结构的文档(Document)集合<br>-每个索引都有自己的mapping定义,用于定义字段名和类型。之前我们也看了一个document有字段名和字段值、他的字段是什么类型通过mapping定义。  </li>
<li>3.一个集群可以有多个索引,比如：nginx日志存储的时候可以按照每天生成一个索引来存储,如下:  <blockquote>
<p>nginx-log-2017-01-01<br>nginx-log-2017-01-02<br>nginx-log-2017-01-03  </p>
</blockquote>
</li>
</ol>
<h3 id="4-restapi介绍"><a href="#4-restapi介绍" class="headerlink" title="4.restapi介绍"></a>4.restapi介绍</h3><p>创建索引与写入数据  </p>
<ol>
<li><p>1.Elasticsearch集群对外提供RESTful API<br>-REST -REpresentational State Transfer(表现层状态转移)<br>-URI指定资源,如Index、Document等<br>-Http Method指明资源操作类型,如:GET、POST、PUT、DELETE等。  </p>
</li>
<li><p>2.常见两种交互方式<br>-Curl命令行<br>-Kibaba DevTools<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/40.png" alt="">  </p>
<h3 id="5-index-API介绍"><a href="#5-index-API介绍" class="headerlink" title="5.index API介绍"></a>5.index API介绍</h3></li>
<li>1.es有专门的Index API,用于创建、更新、删除索引配置等。<br>-创建索引api如下:<br>请求 /索引名<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/41.png" alt=""><br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/42.png" alt="">  <h3 id="6-Document-API介绍"><a href="#6-Document-API介绍" class="headerlink" title="6.Document API介绍"></a>6.Document API介绍</h3></li>
<li>1.es有专门的document API<br>-创建文档<br>第一种方式：指定id(使用put)<br>put /索引/类型/主键  具体json对象<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/43.png" alt=""><br>第二种方式:不指定id(不使用put)<br>post /索引/类型  具体json对象<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/44.png" alt="">  </li>
</ol>
<p>-查询文档<br>主键查询文档<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/45.png" alt=""><br>查询所有文档<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/46.png" alt=""><br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/47.png" alt=""><br>-更新文档<br>使用bulk<br>-删除文档<br>使用bulk<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/48.png" alt=""><br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/49.png" alt="">  </p>
<p>批量查询<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/50.png" alt="">  </p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2019/07/18/ElasticStack-3-Elasticsearch篇之入门/" class="archive-article-date">
  	<time datetime="2019-07-18T15:41:31.000Z" itemprop="datePublished"><i class="icon-clock"></i>2019-07-18</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ElasticStack/">ElasticStack</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-work-8-阿里云oss同步ossutil使用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/10/work-8-阿里云oss同步ossutil使用/">work-8-阿里云oss同步ossutil使用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>阿里云ECS服务器上挂载的录音文件磁盘已经快不够了，为了保证呼叫的正常进行、需要将文件同步到oss阿里云文件服务器中。</p>
<h4 id="1-文件磁盘空间查看"><a href="#1-文件磁盘空间查看" class="headerlink" title="1.文件磁盘空间查看"></a>1.文件磁盘空间查看</h4><ol>
<li>1.查看文件磁盘空间<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/9.png" alt="">  </li>
</ol>
<h4 id="2-linux下阿里云oss搭建"><a href="#2-linux下阿里云oss搭建" class="headerlink" title="2.linux下阿里云oss搭建"></a>2.linux下阿里云oss搭建</h4><p>阿里云oss的操作可参考阿里云官方文档说明:<a href="https://help.aliyun.com/document_detail/50452.html?spm=a2c4g.11186623.3.3.2f012e69aklxKQ" target="_blank" rel="external">https://help.aliyun.com/document_detail/50452.html?spm=a2c4g.11186623.3.3.2f012e69aklxKQ</a>  </p>
<ol>
<li><p>1.查看系统位数:uname -r<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/10.png" alt=""></p>
</li>
<li><p>2.下载ossutil<br>wget <a href="http://gosspublic.alicdn.com/ossutil/1.6.3/ossutil64" target="_blank" rel="external">http://gosspublic.alicdn.com/ossutil/1.6.3/ossutil64</a>  </p>
</li>
<li><p>3.添加到环境变量<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/11.png" alt="">  </p>
</li>
<li><p>4.配置<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/12.png" alt="">  </p>
</li>
<li><p>5.查看oss中的Buckets<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/13.png" alt="">  </p>
</li>
<li><p>6.同步文件<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/14.png" alt="">  </p>
</li>
<li><p>7.同步文件夹<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/15.png" alt=""> </p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ossutil cp -r /cc/data/ivrrecord2/20190619   oss://fz-oss/picccallcenter/ivrrecord2/20190619</div></pre></td></tr></table></figure>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2019/07/10/work-8-阿里云oss同步ossutil使用/" class="archive-article-date">
  	<time datetime="2019-07-10T10:39:31.000Z" itemprop="datePublished"><i class="icon-clock"></i>2019-07-10</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/work/">work</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-SpringCloud-8-Zuul综合使用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/07/SpringCloud-8-Zuul综合使用/">SpringCloud-8-Zuul综合使用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>项目整体架构图如下:<br><a href="https://raw.githubusercontent.com/startshineye/img/master/2019/07/8.png" target="_blank" rel="external"></a>   </p>
<h4 id="8-1-Zuul-Pre和Post过滤器"><a href="#8-1-Zuul-Pre和Post过滤器" class="headerlink" title="8.1 Zuul:Pre和Post过滤器"></a>8.1 Zuul:Pre和Post过滤器</h4><ol>
<li>1.所有的请求都会到Zuul,然后到ServicreA、然后到ServiceB、再到ServiceC、现在我们对整体服务做一个权限校验。假如没有zuul服务、那么ServicreA、ServicreB、ServicreC都得校验一次做的太多受不了。所以权限校验我们放在Zuul里面统一处理。</li>
<li>2.我们以:<a href="http://localhost:8084/myProduct/product/list?token=12121为例子.。我们只有在连接后面添加:token=？才允许校验通过。" target="_blank" rel="external">http://localhost:8084/myProduct/product/list?token=12121为例子.。我们只有在连接后面添加:token=？才允许校验通过。</a>  <h5 id="8-1-1-Zuul统一校验"><a href="#8-1-1-Zuul统一校验" class="headerlink" title="8.1.1 Zuul统一校验"></a>8.1.1 Zuul统一校验</h5></li>
<li><p>1.新建TokenFilter做PRE过滤  </p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">@Component</div><div class="line">public class TokenFilter extends ZuulFilter&#123;</div><div class="line">	</div><div class="line">   @Override</div><div class="line">   public String filterType() &#123;</div><div class="line">       return PRE_TYPE;</div><div class="line">   &#125;</div><div class="line">	</div><div class="line">   @Override</div><div class="line">   public int filterOrder() &#123;</div><div class="line">       /**</div><div class="line">        * filter的顺序:对应的值越低优先级越高</div><div class="line">        * 我们把此Filter放在PRE_DECORATION_FILTER_ORDER前面</div><div class="line">        */</div><div class="line">       return PRE_DECORATION_FILTER_ORDER-1;</div><div class="line">   &#125;</div><div class="line">	</div><div class="line">   @Override</div><div class="line">   public boolean shouldFilter() &#123;</div><div class="line">       /**</div><div class="line">        * 开启过滤</div><div class="line">        */</div><div class="line">       return true;</div><div class="line">   &#125;</div><div class="line">	</div><div class="line">   @Override</div><div class="line">   public Object run() throws ZuulException &#123;</div><div class="line">       RequestContext requestContext = RequestContext.getCurrentContext();</div><div class="line">       HttpServletRequest request = requestContext.getRequest();</div><div class="line">	</div><div class="line">       //这里从url参数里面获取,也可以从cookie,header里获取</div><div class="line">       String token = request.getParameter(&quot;token&quot;);</div><div class="line">       if(StringUtils.isEmpty(token))&#123;</div><div class="line">           requestContext.setSendZuulResponse(false);</div><div class="line">           requestContext.setResponseStatusCode(HttpStatus.UNAUTHORIZED.value());</div><div class="line">       &#125;</div><div class="line">       return null;</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>2.新建Post过滤器    </p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">@Component</div><div class="line">public class AddResponseHeaderFilter extends ZuulFilter&#123;</div><div class="line">    @Override</div><div class="line">    public String filterType() &#123;</div><div class="line">        return POST_TYPE;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public int filterOrder() &#123;</div><div class="line">        return SEND_RESPONSE_FILTER_ORDER - 1;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public boolean shouldFilter() &#123;</div><div class="line">        return true;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public Object run() &#123;</div><div class="line">        RequestContext requestContext = RequestContext.getCurrentContext();</div><div class="line">        HttpServletResponse response = requestContext.getResponse();</div><div class="line">        response.setHeader(&quot;X-Foo&quot;, UUID.randomUUID().toString());</div><div class="line">        return null;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="8-2-Zuul-限流"><a href="#8-2-Zuul-限流" class="headerlink" title="8.2 Zuul:限流"></a>8.2 Zuul:限流</h4><h5 id="8-2-1-限流基本理论"><a href="#8-2-1-限流基本理论" class="headerlink" title="8.2.1 限流基本理论"></a>8.2.1 限流基本理论</h5><ol>
<li>1.Zuul充当的是api网关的角色、每个请求都会经过它、在他上面做api限流保护、防止攻击。比如我们的api是发短信的、我们需要限制客户端请求速度、从而在一定程序上抵制短信大攻击、降低损失。</li>
<li>2.Zuul的限流是放在前置过滤去去做的、更具体来说、时机是在请求被转发之前调用。如果前置过滤器有多个操作、限流放到最靠前那个。比如:Zuul前置过滤器里面有限流、鉴权。那么限流应该早于鉴权。</li>
<li>3.限流方案很多，这里以一种来说:令牌桶流。<br><a href="https://raw.githubusercontent.com/startshineye/img/master/2019/07/16.png" target="_blank" rel="external"></a><br>a.中间桶(token bucket)：是存放令牌的、所以叫做令牌桶。<br>b.最上面会以固定的速率往令牌桶中添加令牌、如果已经放满了就丢掉。<br>c.外部请求过来、会从令牌桶中获取令牌、拿到令牌之后才可以继续往前走。如果拿不到令牌直接被拒绝。其实是和买房一样。 </li>
</ol>
<h5 id="8-2-2-限流代码实现"><a href="#8-2-2-限流代码实现" class="headerlink" title="8.2.2 限流代码实现"></a>8.2.2 限流代码实现</h5><h6 id="1-新建RateFilter类"><a href="#1-新建RateFilter类" class="headerlink" title="1.新建RateFilter类"></a>1.新建RateFilter类</h6><p><a href="https://raw.githubusercontent.com/startshineye/img/master/2019/07/17.png" target="_blank" rel="external"></a><br><a href="https://raw.githubusercontent.com/startshineye/img/master/2019/07/18.png" target="_blank" rel="external"></a>   </p>
<h4 id="8-3-Zuul-鉴权和添加用户服务"><a href="#8-3-Zuul-鉴权和添加用户服务" class="headerlink" title="8.3 Zuul:鉴权和添加用户服务"></a>8.3 Zuul:鉴权和添加用户服务</h4><h5 id="8-3-1-Zuul权限校验"><a href="#8-3-1-Zuul权限校验" class="headerlink" title="8.3.1 Zuul权限校验"></a>8.3.1 Zuul权限校验</h5><p>我们使用Zuul的权限校验实现下面3个功能。</p>
<ol>
<li>1./order/create 只能买家访问(创建订单)  </li>
<li>2./order/finish 只能卖家访问(完结订单) </li>
<li><p>3./product/list 都可以访问(商品列表)  </p>
</li>
<li><p>1.新建鉴权Filter(AuthFilter)<br>新建鉴权Filter、用来区分买家和卖家</p>
</li>
</ol>
<ol>
<li>2.实现逻辑<br>怎样区分买家和卖家呢?有些人想到cookie、既然想到了cookie那么必须买家和卖家登录了之后才能获取到信息。那么登录功能写到哪里了，就需要有一个用户服务。</li>
</ol>
<h5 id="8-3-2-添加用户服务"><a href="#8-3-2-添加用户服务" class="headerlink" title="8.3.2 添加用户服务"></a>8.3.2 添加用户服务</h5><ol>
<li><p>1.API接口登录区分<br><a href="https://raw.githubusercontent.com/startshineye/img/master/2019/07/18.png" target="_blank" rel="external"></a> </p>
</li>
<li><p>2.数据库  </p>
</li>
</ol>
<pre><code>CREATE TABLE `user_info` (
  `id` varchar(32) NOT NULL,
  `username` varchar(32) DEFAULT &apos;&apos;,
  `password` varchar(32) DEFAULT &apos;&apos;,
  `openid` varchar(64) DEFAULT &apos;&apos; COMMENT &apos;微信openid&apos;,
  `role` tinyint(1) NOT NULL COMMENT &apos;1买家2卖家&apos;,
  `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &apos;创建时间&apos;,
  `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT &apos;修改时间&apos;,
  PRIMARY KEY (`id`)
);
</code></pre><ol>
<li><p>3.创建应用<br>选择的依赖组件:<br>1.配置:Cloud Config–&gt;Config Cient<br>2.注册中心:Cloud Discovery–&gt;Eureka Discovery<br>3.数据库:SQL–&gt;Mysql/JPA<br>4.缓存:NoSQL–&gt;redis  </p>
</li>
<li><p>4.修改版本依赖</p>
</li>
<li><p>5.统一配置中心远端服务器创建user-dev.yml文件<br>我们只添加数据库连接信息和redis连接信息，其他信息在bootstrap.yml文件里面  </p>
</li>
</ol>
<ol>
<li><p>6.在config服务中访问:<a href="http://localhost:8083/user-dev.yml可以查看到对应文件" target="_blank" rel="external">http://localhost:8083/user-dev.yml可以查看到对应文件</a></p>
</li>
<li><p>7.因为user服务后面肯定会对外提供接口的、所以我们将其改造成多模块</p>
</li>
</ol>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2019/07/07/SpringCloud-8-Zuul综合使用/" class="archive-article-date">
  	<time datetime="2019-07-07T04:13:24.000Z" itemprop="datePublished"><i class="icon-clock"></i>2019-07-07</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SpringCloud/">SpringCloud</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-ElasticStack-2-入门" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/24/ElasticStack-2-入门/">ElasticStack-2-入门</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="1-内容简介"><a href="#1-内容简介" class="headerlink" title="1.内容简介:"></a>1.内容简介:</h3><p><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/68.png" alt=""> </p>
<h3 id="2-Elastic-Search和Kibana入门"><a href="#2-Elastic-Search和Kibana入门" class="headerlink" title="2.Elastic Search和Kibana入门"></a>2.Elastic Search和Kibana入门</h3><h4 id="2-1-Elasticsearch安装与运行"><a href="#2-1-Elasticsearch安装与运行" class="headerlink" title="2.1 Elasticsearch安装与运行"></a>2.1 Elasticsearch安装与运行</h4><p><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/69.png" alt=""> </p>
<p>浏览器输入:<a href="https://www.elastic.co---&gt;进入products--&gt;进入elasticsearch--&gt;Download" target="_blank" rel="external">https://www.elastic.co---&gt;进入products--&gt;进入elasticsearch--&gt;Download</a><br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/70.png" alt=""><br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/71.png" alt=""><br>我这里以window下为例,下载后解压运行：bin\elasticsearch.bat</p>
<p>我们访问:<a href="http://127.0.0.1:9200就可以确认es是否已经启动。" target="_blank" rel="external">http://127.0.0.1:9200就可以确认es是否已经启动。</a>  </p>
<h4 id="2-2-Elasticsearch配置详解"><a href="#2-2-Elasticsearch配置详解" class="headerlink" title="2.2 Elasticsearch配置详解"></a>2.2 Elasticsearch配置详解</h4><p><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/72.png" alt=""><br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/73.png" alt=""></p>
<ol>
<li><p>1.elasticsearch.yml配置文件说明:<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/74.png" alt=""> </p>
</li>
<li><p>2.Development与 Production模式说明<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/75.png" alt="">  </p>
</li>
</ol>
<h4 id="2-3-Elasticsearch本地快速搭建集群"><a href="#2-3-Elasticsearch本地快速搭建集群" class="headerlink" title="2.3 Elasticsearch本地快速搭建集群"></a>2.3 Elasticsearch本地快速搭建集群</h4><p>window下启动错误解决:<br><a href="https://blog.csdn.net/fanrenxiang/article/details/81358332" target="_blank" rel="external">https://blog.csdn.net/fanrenxiang/article/details/81358332</a>  </p>
<p>集群搭建按照下面图所示:启动3个服务<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/76.png" alt=""> </p>
<ol>
<li><p>1.启动默认的服务<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/77.png" alt=""> </p>
</li>
<li><p>2.启动第二个实例<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/78.png" alt=""><br>查看集群:<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/79.png" alt="">  </p>
</li>
<li><p>3.启动第3个实例<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/80.png" alt=""> </p>
</li>
</ol>
<h4 id="2-4-Kibana安装与演示"><a href="#2-4-Kibana安装与演示" class="headerlink" title="2.4 Kibana安装与演示"></a>2.4 Kibana安装与演示</h4><p>Kibana是使用node.js开发的产品。<br>同样在<a href="https://www.elastic.co/cn/里面的产品--&gt;Kibana--&gt;下载--&gt;Download" target="_blank" rel="external">https://www.elastic.co/cn/里面的产品--&gt;Kibana--&gt;下载--&gt;Download</a><br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/83.png" alt=""></p>
<p><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/84.png" alt=""><br>注意:需要进入kibana.yml文件，然后修改里面的Elasticsearch的地址指向:<br>1.Open config/kibana.yml in an editor<br>2.Set elasticsearch.hosts to point at your Elasticsearch instance</p>
<p>然后访问：<a href="http://localhost:5601" target="_blank" rel="external">http://localhost:5601</a></p>
<h4 id="2-5-Kibana配置详解"><a href="#2-5-Kibana配置详解" class="headerlink" title="2.5 Kibana配置详解"></a>2.5 Kibana配置详解</h4><p>Kibana的配置详解<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/85.png" alt=""><br>Kibana常用功能说明<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/86.png" alt="">  </p>
<h4 id="2-6-Elasticsearch术语介绍与CRUD实际操作"><a href="#2-6-Elasticsearch术语介绍与CRUD实际操作" class="headerlink" title="2.6 Elasticsearch术语介绍与CRUD实际操作"></a>2.6 Elasticsearch术语介绍与CRUD实际操作</h4><h5 id="2-6-1-Elasticsearch常用术语"><a href="#2-6-1-Elasticsearch常用术语" class="headerlink" title="2.6.1 Elasticsearch常用术语"></a>2.6.1 Elasticsearch常用术语</h5><ol>
<li>1.Document文档数据、既然是数据、可以理解成数据表里面的一条数据。</li>
<li>2.Index 索引 可以理解成:数据库。所有document都是存在于Index数据中的。    </li>
<li>3.Type索引中的数据类型。可以理解成数据库中的一个表</li>
<li>4.Field字段、文档的属性。类似于mysql中的字段。</li>
<li>5.Query DSL查询语句。</li>
</ol>
<h5 id="2-6-2-Elasticsearch的CRUD"><a href="#2-6-2-Elasticsearch的CRUD" class="headerlink" title="2.6.2 Elasticsearch的CRUD"></a>2.6.2 Elasticsearch的CRUD</h5><p>CRUD其实就是数据的增删改查,这里面的数据就是文档，所以CRUD只是对文档的操作。  </p>
<ol>
<li>1.Create 创建文档  </li>
<li>2.Read 读取文档  </li>
<li>3.Update 更新文档  </li>
<li>4.Delete 删除文档  </li>
</ol>
<p>我们在Index(accounts)下创建一个type(person)文档id为1  文档内容就是下面的左图json格式。右边是一个创建文档后返回的内容。<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/87.png" alt=""> </p>
<p>我们需要实际操作的话,只需要在Kibanna的Dev Tools下的console中输入一下内容。<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/88.png" alt=""><br>上面文档就算插入成功了，文档插入成功之后、我们需要获取这个文档也就是读取文档：read<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/89.png" alt=""> </p>
<p>更新<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/90.png" alt=""> </p>
<p>删除<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/91.png" alt="">  </p>
<h4 id="2-7-Elasticsearch查询简介"><a href="#2-7-Elasticsearch查询简介" class="headerlink" title="2.7 Elasticsearch查询简介"></a>2.7 Elasticsearch查询简介</h4><ol>
<li><p>1.查询的基本语法<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/92.png" alt="">  </p>
</li>
<li><p>2.查询实例<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/93.png" alt="">  </p>
</li>
<li><p>3.在官方文档可以查看到详细的语法<br>进入官网–&gt;lean(了解)–&gt;doc(文档) –&gt;Elasticsearch Reference–&gt;Query DSL</p>
</li>
</ol>
<h3 id="3-Beats、Filebea入门"><a href="#3-Beats、Filebea入门" class="headerlink" title="3.Beats、Filebea入门"></a>3.Beats、Filebea入门</h3><h4 id="3-1-Beats简介"><a href="#3-1-Beats简介" class="headerlink" title="3.1 Beats简介"></a>3.1 Beats简介</h4><p>Beats定义:Lightweight Data Shipper(官方定义为:轻量级的数据传送者)。官方目前有下面几个beats。</p>
<ol>
<li>1.Filebeat—主要针对日志文件  </li>
<li>2.Metricbeat—主要收集：像操作系统、CPU、内存、磁盘、还有像常用软件:nginx、Mysql的度量指标。Metricbeat能很快收集这些度量指标、然后很快的放入es中进行可视化分析、展示、告警。</li>
<li>3.Packetbeat—网络数据(比如服务器传输情况)   </li>
<li>4.Winlogbeat Window 数据—Window的日志数据。</li>
<li>5.Heartbeat—健康检查<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/94.png" alt=""><br>如上图我们知道：Beat处于数据的起始端、他们可以将数据直接存储到Elasticsearch中、也可以传输到logstash,然后logstash通过分析或者转换把数据传送到Elasticsearch中、最后通过Kibana对数据进行展示。</li>
</ol>
<h4 id="3-2Filebeat简介"><a href="#3-2Filebeat简介" class="headerlink" title="3.2Filebeat简介"></a>3.2Filebeat简介</h4><p>Filebeat主要是对日志文件进行处理的，如下为处理流程:<br>Filebeat输入日志文件、拿到日志文件后进行简单处理(Filter)、然后输出OutPut</p>
<p>我们用以下图查看Filebeat的构成:<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/95.png" alt="">  </p>
<ol>
<li>1.左边是Filebeat,右边是Filebeat的输出对象。我们可以看到输出对象有:Elasticsearch、Logstash、Kafka、Redis</li>
<li>2.从左边可以看到Filebeat包含两个部分：Prospect(观察者)和Harvester(收割者)<br>Prospect针对/var/log/*.log文件可以探测其文件是否有变化、如果有变化  Harvester就需要收集新的日志。将日志从每一个日志文件中取出来、然后发送到output对象。</li>
<li>3.一个Filebeat可以有多个Prospect(观察者)和Harvester(收割者)、上面的Prospect(观察者)和Harvester(收割者)针对的日志文件是不同”的。</li>
<li>4.Prospect(观察者)针对于不同的配置文件(system.log和wifi.log)会启动多个Harvester。也就是一个Harvester针对于一个配置文件。</li>
</ol>
<h4 id="3-3-Filebeat配置简介"><a href="#3-3-Filebeat配置简介" class="headerlink" title="3.3 Filebeat配置简介"></a>3.3 Filebeat配置简介</h4><h5 id="3-3-1-Filebeat-Input配置简介"><a href="#3-3-1-Filebeat-Input配置简介" class="headerlink" title="3.3.1 Filebeat Input配置简介"></a>3.3.1 Filebeat Input配置简介</h5><p><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/96.png" alt=""> </p>
<ol>
<li>2.使用yml语法、跟之前elasticsearch一致。  </li>
<li>2.Filebeat其中一个组成是Prospect、在其配置文件中有一个Prospect配置。  </li>
<li>3.之前说了Prospect是不止一个的、可以配置多个。所以是个数组。yml的数组格式使用”-“隔离的。上图是配置了两个Prospect</li>
<li>4每一个Prospect有自己的输入类型、这里是log、说明是配置文件。paths也是一个数组、用于指定日志的路径的。</li>
<li>5.目前input_type有两个类型:一个是log、另一个是stdin(标准输入)</li>
</ol>
<h5 id="3-3-2-Filebeat-Output配置简介"><a href="#3-3-2-Filebeat-Output配置简介" class="headerlink" title="3.3.2 Filebeat Output配置简介"></a>3.3.2 Filebeat Output配置简介</h5><p><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/97.png" alt=""></p>
<ol>
<li>1.Filebeat Output支持以下类型对象:Console(标准输出)、Elasticsearch、Logstash、Kafka、Redis、File(指把一个日志文件输出到另一个日志文件中)。</li>
</ol>
<h5 id="3-3-3-Filebeat-Filter配置简介"><a href="#3-3-3-Filebeat-Filter配置简介" class="headerlink" title="3.3.3 Filebeat Filter配置简介"></a>3.3.3 Filebeat Filter配置简介</h5><p>对读入的内容进行一定的处理、当然他的处理能力相对较弱。例如:<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/98.png" alt=""><br>例子:<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/99.png" alt=""></p>
<h4 id="3-4Filebeat高级使用简介"><a href="#3-4Filebeat高级使用简介" class="headerlink" title="3.4Filebeat高级使用简介"></a>3.4Filebeat高级使用简介</h4><ol>
<li><p>1.从上面我们知道Filebea缺乏数据转换的能力。针对于这个问题，Elasticsearch增加了一个Node类型、Elasticsearch Ingest Node<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/100.png" alt=""></p>
</li>
<li><p>2.Filebeat Module简介:Filebeat本身想把数据快速存放到Elasticsearch中大致要做一些处理，首先要写合适的Filebeat配置文件。然后去配置Ingest Node中的pipeline、然后对存储的数据进行kibana的合理的可视化配置。Filebeat看到了这些数据做起来是比较复杂的。所以官方推出了一些模块、把常用的日志格式做了统一化的处理达到开箱急用的配置。<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/101.png" alt=""></p>
</li>
</ol>
<h4 id="3-5-Filebeat演示"><a href="#3-5-Filebeat演示" class="headerlink" title="3.5 Filebeat演示"></a>3.5 Filebeat演示</h4><p>实际演示Filebeat收集nginx log<br>1.我们通过stdin收集日志。<br>2.通过console输出结果。  </p>
<p>实践  </p>
<ol>
<li>1.下载Filebeat(Filebeat是基于go开发、需要下载不同的安装包)  </li>
<li><p>2.查看我们需要收集的nginx日志<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/102.png" alt="">  </p>
</li>
<li><p>3.配置我们的filebeat<br>a.input_type: stdin (我们从标准输入流获取数据)<br>b.output.console: pretty: true  </p>
</li>
<li><p>4.接下来用filebeat:收集nginx的两条数据<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/103.png" alt="">  </p>
</li>
<li><p>5.最后获取到的信息是:<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/104.png" alt="">  </p>
</li>
</ol>
<h4 id="3-6-Packetbeat简介"><a href="#3-6-Packetbeat简介" class="headerlink" title="3.6 Packetbeat简介"></a>3.6 Packetbeat简介</h4><h5 id="3-6-1-简介"><a href="#3-6-1-简介" class="headerlink" title="3.6.1 简介"></a>3.6.1 简介</h5><p><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/105.png" alt=""><br>拥有了Packetbeat类似于就拥有了轻量级的wireshake<br>1.实时抓取网络包<br>2.自动解析应用层协议  </p>
<h5 id="3-6-2-demo抓取es的网络数据包"><a href="#3-6-2-demo抓取es的网络数据包" class="headerlink" title="3.6.2 demo抓取es的网络数据包"></a>3.6.2 demo抓取es的网络数据包</h5><p><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/106.png" alt="">  </p>
<p>1 1.指定网卡:lo0  </p>
<ol>
<li>2.protocols:指定协议  </li>
<li>3.ports:指定端口  </li>
<li>4.send_request:true 指定request请求的body,默认为false   </li>
</ol>
<p><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/107.png" alt="">  </p>
<h4 id="3-7-Packetbeat演示"><a href="#3-7-Packetbeat演示" class="headerlink" title="3.7 Packetbeat演示"></a>3.7 Packetbeat演示</h4><ol>
<li>1.下载包  </li>
<li>2.我们抓取es的包、首先我们把es跑起来  </li>
<li>3.检查配置<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/108.png" alt=""><br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/109.png" alt="">  </li>
<li><p>4.运行paketbeat：<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/110.png" alt="">  </p>
</li>
<li><p>5.查看paketbeat输出<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/111.png" alt="">  </p>
</li>
</ol>
<h3 id="4、Logstash入门"><a href="#4、Logstash入门" class="headerlink" title="4、Logstash入门"></a>4、Logstash入门</h3><h4 id="4-1-Logstash简介"><a href="#4-1-Logstash简介" class="headerlink" title="4.1 Logstash简介"></a>4.1 Logstash简介</h4><ol>
<li>1.Logstash定义为一个:Data Shipper、他比Beats的定义少了一个light-weight<br>也就是说Logstash不是轻量级的、会比Beats占用更多的资源。所以会占用一定的资源、当然功能 也会越强大。</li>
<li><p>2.Logstash其实就是具备ETL的功能、对数据进行以下操作:<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/112.png" alt="">  </p>
</li>
<li><p>3.处理流程(其实就是3步:input、Filter、Output)<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/113.png" alt="">  </p>
</li>
</ol>
<h4 id="4-2-Logstash配置"><a href="#4-2-Logstash配置" class="headerlink" title="4.2 Logstash配置"></a>4.2 Logstash配置</h4><h5 id="4-2-1-我们看下Input和Output配置。"><a href="#4-2-1-我们看下Input和Output配置。" class="headerlink" title="4.2.1 我们看下Input和Output配置。"></a>4.2.1 我们看下Input和Output配置。</h5><p><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/114.png" alt=""> </p>
<ol>
<li>1.logstash的配置不是yml文件、指定的是一个file文件、path路径是在tmp文件下面的。  </li>
<li>2.output是指标准输出、指定的编码是:rubydebug  </li>
</ol>
<h5 id="4-2-2-Filter配置"><a href="#4-2-2-Filter配置" class="headerlink" title="4.2.2 Filter配置"></a>4.2.2 Filter配置</h5><p><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/115.png" alt=""><br>实例:<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/116.png" alt="">  </p>
<h4 id="4-3-Logstash演示"><a href="#4-3-Logstash演示" class="headerlink" title="4.3 Logstash演示"></a>4.3 Logstash演示</h4><p>我们使用Logstash收集nginx log  经过logstash输出日志会是怎样子?<br>我们正常下载Logstash，然后解压，最后我们进入:nginx_logstash.conf,主要是需要配置3个地方。logstash有3大配置:input配置、filter配置、output配置。</p>
<ol>
<li>1.input<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/20.png" alt=""><br>标准输入</li>
<li>2.filter<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/21.png" alt=""></li>
<li>3.output</li>
</ol>
<p>我们启动logstash<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/22.png" alt="">  </p>
<h3 id="5、案例实战"><a href="#5、案例实战" class="headerlink" title="5、案例实战"></a>5、案例实战</h3><h4 id="5-1-实战目标和方案介绍"><a href="#5-1-实战目标和方案介绍" class="headerlink" title="5.1 实战目标和方案介绍"></a>5.1 实战目标和方案介绍</h4><p>我们此次实践的目标:  </p>
<ol>
<li>1.收集Elasticsearch集群的查询语句。  </li>
<li>2.分析查询语句的常用语句、相应时长等。</li>
</ol>
<p>方案:</p>
<ol>
<li>1.应用Packetbeat+Logstash完成数据收集工作  </li>
<li>2.使用Kibaba+Elasticsearch完成数据分析工作  </li>
</ol>
<p>架构图如下:<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/23.png" alt="">  </p>
<ol>
<li>1.Production cluster就是我们业务集群  我们现在监控他的es查询语句情况  </li>
<li>2.做法:我们用Packetbeat监听Production cluster端口、然后所有的查询语句通过网络抓包的形式都可以获取到、然后Packetbeat将所有数据发送到logstash、然后发送给监控集群、最后通过监控集群发送给Kibana。<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/24.png" alt="">   </li>
</ol>
<p>方案之logstash:<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/30.png" alt="">   </p>
<ol>
<li>1.input输入:接收beats的数据 监听的端口是:5044  </li>
<li>2.filter中:如果request请求中包含search的关键字、我们再做grok处理  </li>
<li>3.output中也做了判断:请求中有search时候、我们输出到 elasticsearch  </li>
</ol>
<p>方案之packetbeat:<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/31.png" alt="">  </p>
<h4 id="5-2-实战之数据收集演示"><a href="#5-2-实战之数据收集演示" class="headerlink" title="5.2 实战之数据收集演示"></a>5.2 实战之数据收集演示</h4><h5 id="5-2-1-启动elasticsearch"><a href="#5-2-1-启动elasticsearch" class="headerlink" title="5.2.1 启动elasticsearch"></a>5.2.1 启动elasticsearch</h5><p><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/32.png" alt="">  </p>
<h5 id="5-2-2-启动Kinbana"><a href="#5-2-2-启动Kinbana" class="headerlink" title="5.2.2 启动Kinbana"></a>5.2.2 启动Kinbana</h5><p><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/07/33.png" alt="">   </p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2019/06/24/ElasticStack-2-入门/" class="archive-article-date">
  	<time datetime="2019-06-24T15:47:55.000Z" itemprop="datePublished"><i class="icon-clock"></i>2019-06-24</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ElasticStack/">ElasticStack</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-ElasticStack-1-前言" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/24/ElasticStack-1-前言/">ElasticStack-1-前言</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="1-为什么使用ElasticStack"><a href="#1-为什么使用ElasticStack" class="headerlink" title="1.为什么使用ElasticStack"></a>1.为什么使用ElasticStack</h4><p>我们知道的一般大数据分析工具有如下:<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/57.png" alt=""><br>我们为什么还需要使用ElasticStack呢?<br>原因:  </p>
<ol>
<li>1.使用门槛低、开发周期短、上线快<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/58.png" alt="">  </li>
<li>2.性能好、查询快、实时展示结果<br>对T+1说不，以前我们查询数据结果，都是时隔一段时间或者一天再分析，现在我们需要”现在、立刻马上要数据”  </li>
<li><p>3.扩容方便、快速支撑增长迅猛的数据<br>刚开始也许只是GB数据、随着业务量变大、TB、PB级别的数据也不是问题。<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/59.png" alt=""> </p>
<h4 id="2-简介"><a href="#2-简介" class="headerlink" title="2.简介"></a>2.简介</h4><h5 id="2-1-ElasticStack组成"><a href="#2-1-ElasticStack组成" class="headerlink" title="2.1 ElasticStack组成"></a>2.1 ElasticStack组成</h5><p>传统的ELK其实就是:Elasticsearch、Logstash、Kibana，自从加入了Beats后,进行升级，变成了Elastic Stack。<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/60.png" alt="">   </p>
<h5 id="2-2-各个模块功能"><a href="#2-2-各个模块功能" class="headerlink" title="2.2 各个模块功能"></a>2.2 各个模块功能</h5><p><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/61.png" alt="">  </p>
</li>
<li><p>1.Elasticsearch主要是做数据处理的  </p>
</li>
<li>2.Beats和    Logstash是做数据收集与处理，相当于早期的ETL<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/62.png" alt=""></li>
<li>3.Kibna数据搜索与可视化分析<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/63.png" alt=""></li>
</ol>
<h5 id="2-3-ElasticStack功能"><a href="#2-3-ElasticStack功能" class="headerlink" title="2.3 ElasticStack功能"></a>2.3 ElasticStack功能</h5><p>一定要内外兼修、不仅仅会使用API还得了解原理。  </p>
<ol>
<li>1.ElasticStack是一个完备的数据分析工具集合<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/64.png" alt=""></li>
<li>2.学习安排:<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/65.png" alt="">  </li>
<li><p>3.Elasticsearch篇章讲解举例<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/66.png" alt="">  </p>
</li>
<li><p>4.实践项目<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2019/06/67.png" alt=""> </p>
</li>
</ol>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2019/06/24/ElasticStack-1-前言/" class="archive-article-date">
  	<time datetime="2019-06-24T14:40:53.000Z" itemprop="datePublished"><i class="icon-clock"></i>2019-06-24</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ElasticStack/">ElasticStack</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/51/">51</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
    </nav>
  


      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2019 Startshineye
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: "/",
		innerArchive: true
	}
</script>

<script src="/./main.js"></script>


    
<div class="tools-col">
  <ul class="btn-wrap">
    
      <li class="chose" data-hook="tools-section-all"><span class="text">全部</span><i class="icon-book"></i></li>
    
    
      <li data-hook="tools-section-tag"><span class="text">标签</span><i class="icon-price-tags"></i></li>
    
    
      <li data-hook="tools-section-friends"><span class="text">友链</span><i class="icon-link"></i></li>
    
    
      <li data-hook="tools-section-me"><span class="text">我</span><i class="icon-smile"></i></li>
    
  </ul>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all chose">
    	</section>
    

    
    	<section class="tools-section tools-section-tag">
    			<div class="widget tagcloud" id="js-tagcloud">
    				<a href="/tags/Android/" style="font-size: 20px;">Android</a> <a href="/tags/CTI/" style="font-size: 11.05px;">CTI</a> <a href="/tags/Cookie/" style="font-size: 10.53px;">Cookie</a> <a href="/tags/DevelopmentSkills/" style="font-size: 10px;">DevelopmentSkills</a> <a href="/tags/Easyui/" style="font-size: 10px;">Easyui</a> <a href="/tags/ElasticStack/" style="font-size: 14.74px;">ElasticStack</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/Github/" style="font-size: 10px;">Github</a> <a href="/tags/Http/" style="font-size: 10px;">Http</a> <a href="/tags/IE问题/" style="font-size: 10px;">IE问题</a> <a href="/tags/JDK/" style="font-size: 10px;">JDK</a> <a href="/tags/JSP/" style="font-size: 10px;">JSP</a> <a href="/tags/JVM/" style="font-size: 12.11px;">JVM</a> <a href="/tags/JavaSE/" style="font-size: 15.79px;">JavaSE</a> <a href="/tags/Jeecg/" style="font-size: 11.58px;">Jeecg</a> <a href="/tags/Maven/" style="font-size: 10px;">Maven</a> <a href="/tags/MongoDB/" style="font-size: 10px;">MongoDB</a> <a href="/tags/Myeclipse/" style="font-size: 14.21px;">Myeclipse</a> <a href="/tags/Netty/" style="font-size: 16.84px;">Netty</a> <a href="/tags/Node-js/" style="font-size: 10px;">Node.js</a> <a href="/tags/Oracle/" style="font-size: 16.84px;">Oracle</a> <a href="/tags/Redis/" style="font-size: 12.11px;">Redis</a> <a href="/tags/Servlet/" style="font-size: 11.58px;">Servlet</a> <a href="/tags/Spring/" style="font-size: 10.53px;">Spring</a> <a href="/tags/Spring-Boot/" style="font-size: 10px;">Spring Boot</a> <a href="/tags/SpringBoot/" style="font-size: 19.47px;">SpringBoot</a> <a href="/tags/SpringCloud/" style="font-size: 12.11px;">SpringCloud</a> <a href="/tags/SpringMVC/" style="font-size: 11.05px;">SpringMVC</a> <a href="/tags/Tomcat/" style="font-size: 10px;">Tomcat</a> <a href="/tags/Vue/" style="font-size: 18.95px;">Vue</a> <a href="/tags/Vue-js-前端开发-快速入门与专业应用/" style="font-size: 17.37px;">Vue.js+前端开发+快速入门与专业应用</a> <a href="/tags/Weblogic/" style="font-size: 12.11px;">Weblogic</a> <a href="/tags/Websocket/" style="font-size: 10.53px;">Websocket</a> <a href="/tags/Work-Problem/" style="font-size: 10px;">Work-Problem</a> <a href="/tags/acdgate/" style="font-size: 10px;">acdgate</a> <a href="/tags/bg/" style="font-size: 10px;">bg</a> <a href="/tags/c/" style="font-size: 10.53px;">c</a> <a href="/tags/crawler/" style="font-size: 17.89px;">crawler</a> <a href="/tags/dubbo/" style="font-size: 10px;">dubbo</a> <a href="/tags/easyui/" style="font-size: 10px;">easyui</a> <a href="/tags/freeswitch/" style="font-size: 10px;">freeswitch</a> <a href="/tags/hibernate/" style="font-size: 10.53px;">hibernate</a> <a href="/tags/html-css/" style="font-size: 10.53px;">html+css</a> <a href="/tags/html-css/" style="font-size: 15.79px;">html-css</a> <a href="/tags/html-ss/" style="font-size: 10px;">html-ss</a> <a href="/tags/im/" style="font-size: 13.68px;">im</a> <a href="/tags/ipcc/" style="font-size: 10.53px;">ipcc</a> <a href="/tags/jQuery/" style="font-size: 12.11px;">jQuery</a> <a href="/tags/java/" style="font-size: 10px;">java</a> <a href="/tags/java-String/" style="font-size: 10px;">java String</a> <a href="/tags/javaSE/" style="font-size: 10.53px;">javaSE</a> <a href="/tags/javaWeb/" style="font-size: 10px;">javaWeb</a> <a href="/tags/javascript/" style="font-size: 11.05px;">javascript</a> <a href="/tags/java并发编程/" style="font-size: 11.58px;">java并发编程</a> <a href="/tags/java集合/" style="font-size: 10.53px;">java集合</a> <a href="/tags/junit测试/" style="font-size: 10px;">junit测试</a> <a href="/tags/life/" style="font-size: 10px;">life</a> <a href="/tags/linux/" style="font-size: 16.84px;">linux</a> <a href="/tags/log4j/" style="font-size: 11.58px;">log4j</a> <a href="/tags/maven/" style="font-size: 10px;">maven</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/netty/" style="font-size: 11.58px;">netty</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/tags/nodeJs/" style="font-size: 10px;">nodeJs</a> <a href="/tags/redis/" style="font-size: 12.63px;">redis</a> <a href="/tags/servlet/" style="font-size: 10px;">servlet</a> <a href="/tags/shiro/" style="font-size: 12.63px;">shiro</a> <a href="/tags/sockJs/" style="font-size: 10px;">sockJs</a> <a href="/tags/socket网络编程/" style="font-size: 10.53px;">socket网络编程</a> <a href="/tags/struts1/" style="font-size: 11.05px;">struts1</a> <a href="/tags/vue/" style="font-size: 10.53px;">vue</a> <a href="/tags/web/" style="font-size: 10px;">web</a> <a href="/tags/weblogic/" style="font-size: 11.05px;">weblogic</a> <a href="/tags/websocket/" style="font-size: 16.32px;">websocket</a> <a href="/tags/work/" style="font-size: 15.26px;">work</a> <a href="/tags/zyzx/" style="font-size: 18.42px;">zyzx</a> <a href="/tags/代理/" style="font-size: 11.58px;">代理</a> <a href="/tags/前端/" style="font-size: 10.53px;">前端</a> <a href="/tags/动手写一个MVC/" style="font-size: 12.11px;">动手写一个MVC</a> <a href="/tags/反射/" style="font-size: 16.32px;">反射</a> <a href="/tags/异常/" style="font-size: 10px;">异常</a> <a href="/tags/微博/" style="font-size: 10px;">微博</a> <a href="/tags/文件读取/" style="font-size: 10px;">文件读取</a> <a href="/tags/泛型/" style="font-size: 13.16px;">泛型</a> <a href="/tags/注解/" style="font-size: 11.05px;">注解</a> <a href="/tags/类加载器/" style="font-size: 13.16px;">类加载器</a> <a href="/tags/线程/" style="font-size: 10px;">线程</a> <a href="/tags/自己写一个apache服务器/" style="font-size: 16.84px;">自己写一个apache服务器</a> <a href="/tags/转载/" style="font-size: 12.11px;">转载</a> <a href="/tags/集合/" style="font-size: 12.11px;">集合</a>
    			</div>
    	</section>
    

    
    	<section class="tools-section tools-section-friends">
  		
  			<div class="friends-wrap" id="js-friends">
  			
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.baidu.com/">baidu</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.jd.com/">jd</a>
  	        
  	        </div>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">毕业于&lt;br&gt;相信技术可以改变人与人之间的生活&lt;br&gt;码农一枚</div>
  	  	
    	</section>
    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>