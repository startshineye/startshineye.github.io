<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>Startshineye的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="毕业于石大，相信技术可以改变人与人之间的生活，码农一枚">
<meta property="og:type" content="website">
<meta property="og:title" content="Startshineye的博客">
<meta property="og:url" content="https://github.com/startshineye/page/5/index.html">
<meta property="og:site_name" content="Startshineye的博客">
<meta property="og:description" content="毕业于石大，相信技术可以改变人与人之间的生活，码农一枚">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Startshineye的博客">
<meta name="twitter:description" content="毕业于石大，相信技术可以改变人与人之间的生活，码农一枚">
  
    <link rel="alternative" href="/atom.xml" title="Startshineye的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <script src="/style.js"></script>
  

</head>

<body>
  <div id="container">
    <div class="left-col">
      <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			 <img src="https://raw.githubusercontent.com/startshineye/img/master/2017/king.jpg" class="js-avatar show">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Startshineye</a></h1>
		</hgroup>

		
		<p class="header-subtitle">淡泊明志，宁静致远</p>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
				<li><a href="/archives">所有文章</a></li>
	        
				<li><a href="/tags/随笔">随笔</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
	        
    		
    			
    			<a class="js-smart-menu" data-idx="0" href="javascript:void(0)">所有文章</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="1" href="javascript:void(0)">标签</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="2" href="javascript:void(0)">友链</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="3" href="javascript:void(0)">关于我</a>
    			
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="https://github.com/startshineye" title="github">github</a>
		        
					<a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
		        
					<a class="rss" target="_blank" href="#" title="rss">rss</a>
		        
					<a class="zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
		        
					<a class="mail" target="_blank" href="#" title="mail">mail</a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"><i class="icon-list"></i></div>
  		<h1 class="header-author js-mobile-header hide">Startshineye</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img src="https://raw.githubusercontent.com/startshineye/img/master/2017/king.jpg" class="js-avatar show">
				
			</div>
			<hgroup>
			  <h1 class="header-author">Startshineye</h1>
			</hgroup>
			
			<p class="header-subtitle">淡泊明志，宁静致远</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
					<li><a href="/tags/随笔">随笔</a></li>
		        
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/startshineye" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
			        
						<a class="rss" target="_blank" href="#" title="rss">rss</a>
			        
						<a class="zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
			        
						<a class="mail" target="_blank" href="#" title="mail">mail</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
        
  
    <article id="post-netty实践-十-自定义数据包协议" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/11/26/netty实践-十-自定义数据包协议/">netty实践(十)-自定义数据包协议</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><ol>
<li>序列化协议:把数据对象转化成二进制数据,因为网络传输只能传输二进制数据    </li>
<li>自定义数据包协议又是 干什么的呢？  </li>
<li>场景:客户端 发送请求 先发送:give me a coffee 再发送 give me  a tea 按理说服务端是先接受到give me a coffee 再接收到give me a tea <h4 id="内容"><a href="#内容" class="headerlink" title="内容"></a>内容</h4></li>
</ol>
<h5 id="1-两种现象"><a href="#1-两种现象" class="headerlink" title="1.两种现象"></a>1.两种现象</h5><h6 id="1-1-粘包现象"><a href="#1-1-粘包现象" class="headerlink" title="1.1 粘包现象"></a>1.1 粘包现象</h6><p>服务端收到的请求也许是黏在一起的:give me a coffeegive me a tea所以没有人能够翻译这句话是什么意思？<br>没办法解析。这种现象叫做粘包现象。</p>
<h6 id="1-2-分包现象"><a href="#1-2-分包现象" class="headerlink" title="1.2 分包现象"></a>1.2 分包现象</h6><p>收到:give me<br>a coffeegive me a tea   </p>
<p>出现粘包，分包的根本原因：没有一个稳定数据结构 导致服务器无法区分一个请求到底是传输了哪些数据</p>
<h5 id="2-两种解决思路"><a href="#2-两种解决思路" class="headerlink" title="2.两种解决思路"></a>2.两种解决思路</h5><h6 id="2-1-分隔符"><a href="#2-1-分隔符" class="headerlink" title="2.1 分隔符"></a>2.1 分隔符</h6><p>1.分隔符: give me a coffee|give me a tea|<br>缺点:效率低,频繁读取数据(我们要把每个数据一个个读取,查看是否是想要的数据)</p>
<h6 id="2-2-长度-数据"><a href="#2-2-长度-数据" class="headerlink" title="2.2 长度+数据"></a>2.2 长度+数据</h6><p>2.长度+数据:16give me a coffee13give me a tea</p>
<h5 id="3-数据包协议"><a href="#3-数据包协议" class="headerlink" title="3.数据包协议"></a>3.数据包协议</h5><h5 id="3-1-数据包结构"><a href="#3-1-数据包结构" class="headerlink" title="3.1 数据包结构"></a>3.1 数据包结构</h5><p><img src="31" alt=""><br>包头4个字节:int<br>模块号2个字节:short<br>命令号2个字节:short</p>
<p>场景:<br>比如游戏中:分为很多模块,玩家Player模块<br>发送以下请求:<br>1.获取玩家数据 2.注册用户 3.购买金币<br>请求数据不一样  </p>
<p>Fuben模块<br>发送以下两个请求:<br>1 查看副本<br>2 攻打副本<br>以上场景中:Player,Fuben对应模块 发送请求对应命令。  </p>
<h5 id="4-代码"><a href="#4-代码" class="headerlink" title="4.代码"></a>4.代码</h5><p>我们自定义数据包来封装我们的请求和响应,由于是共有的,所以创建共有的java项目：common</p>
<h6 id="4-1-请求-Request"><a href="#4-1-请求-Request" class="headerlink" title="4.1 请求(Request)"></a>4.1 请求(Request)</h6><p>1.请求:(Request:由于包头是请求的头部信息,所以我们不包含在request中)</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line">   /**</div><div class="line"> * </div><div class="line"> * &lt;pre&gt;</div><div class="line"> * 数据包格式</div><div class="line"> * +——----——+——-----——+——----——+——----——+——-----——+</div><div class="line"> * | 包头	| 模块号  | 命令号 |  长度  |   数据  |</div><div class="line"> * +——----——+——-----——+——----——+——----——+——-----——+</div><div class="line"> * &lt;/pre&gt;</div><div class="line"> * 包头4字节</div><div class="line"> * 模块号2字节short</div><div class="line"> * 命令号2字节short</div><div class="line"> * 长度4字节(描述数据部分字节长度)</div><div class="line"> * 数据4字节</div><div class="line"> */</div><div class="line">public class Request &#123;</div><div class="line">/**</div><div class="line"> * 模块号</div><div class="line"> */</div><div class="line">private short module;</div><div class="line">/**</div><div class="line"> * 命令号</div><div class="line"> */</div><div class="line">private short cmd;</div><div class="line">/**</div><div class="line"> * 数据</div><div class="line"> */</div><div class="line">private byte[] data;</div><div class="line">public short getModule() &#123;</div><div class="line">	return module;</div><div class="line">&#125;</div><div class="line">public void setModule(short module) &#123;</div><div class="line">	this.module = module;</div><div class="line">&#125;</div><div class="line">public short getCmd() &#123;</div><div class="line">	return cmd;</div><div class="line">&#125;</div><div class="line">public void setCmd(short cmd) &#123;</div><div class="line">	this.cmd = cmd;</div><div class="line">&#125;</div><div class="line">public byte[] getData() &#123;</div><div class="line">	return data;</div><div class="line">&#125;</div><div class="line">public void setData(byte[] data) &#123;</div><div class="line">	this.data = data;</div><div class="line">&#125;</div><div class="line">/**</div><div class="line"> * 获取数据长度</div><div class="line"> */</div><div class="line">public int getDataLength()&#123;</div><div class="line">	if(this.data==null)&#123;</div><div class="line">		return 0;</div><div class="line">	&#125;</div><div class="line">	return this.data.length;</div><div class="line">&#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
</code></pre><p>2.RequestEncoder</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">   import org.jboss.netty.buffer.ChannelBuffer;</div><div class="line">import org.jboss.netty.buffer.ChannelBuffers;</div><div class="line">import org.jboss.netty.channel.Channel;</div><div class="line">import org.jboss.netty.channel.ChannelHandlerContext;</div><div class="line">import org.jboss.netty.handler.codec.oneone.OneToOneEncoder;</div><div class="line"></div><div class="line">import com.cn.constants.Constants;</div><div class="line">import com.cn.model.Request;</div><div class="line">/**</div><div class="line"> * 请求编码器</div><div class="line"> * * &lt;pre&gt;</div><div class="line"> * 数据包格式</div><div class="line"> * +——----——+——-----——+——----——+——----——+——-----——+</div><div class="line"> * | 包头          | 模块号        | 命令号      |  长度        |   数据       |</div><div class="line"> * +——----——+——-----——+——----——+——----——+——-----——+</div><div class="line"> * &lt;/pre&gt;</div><div class="line"> * 包头4字节</div><div class="line"> * 模块号2字节short</div><div class="line"> * 命令号2字节short</div><div class="line"> * 长度4字节(描述数据部分字节长度)</div><div class="line"> * @author yxm</div><div class="line"> *</div><div class="line"> */</div><div class="line">   public class RequestEncoder extends OneToOneEncoder&#123;</div><div class="line">@Override</div><div class="line">protected Object encode(ChannelHandlerContext ctx, Channel channel,</div><div class="line">		Object msg) throws Exception &#123;</div><div class="line">	Request request = (Request)msg;</div><div class="line">	</div><div class="line">	ChannelBuffer buffer = ChannelBuffers.dynamicBuffer();</div><div class="line">	//包头   </div><div class="line">	buffer.writeInt(Constants.FLAG);</div><div class="line">	//模块号</div><div class="line">	buffer.writeShort(request.getModule());</div><div class="line">	//命令号  </div><div class="line">	buffer.writeShort(request.getCmd());</div><div class="line">	// 长度   </div><div class="line">	buffer.writeInt(request.getDataLength());</div><div class="line">	//数据(数据不为空,才读取到buffer)</div><div class="line">	if(request.getData()!=null)&#123;</div><div class="line">		buffer.writeBytes(request.getData());</div><div class="line">	&#125;</div><div class="line">	return buffer;</div><div class="line">&#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
</code></pre><p>3.RequestDecoder  </p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div></pre></td><td class="code"><pre><div class="line">   import org.jboss.netty.buffer.ChannelBuffer;</div><div class="line">import org.jboss.netty.channel.Channel;</div><div class="line">import org.jboss.netty.channel.ChannelHandlerContext;</div><div class="line">import org.jboss.netty.handler.codec.frame.FrameDecoder;</div><div class="line"></div><div class="line">import com.cn.constants.Constants;</div><div class="line">import com.cn.model.Request;</div><div class="line"></div><div class="line">/**</div><div class="line"> * 请求解码器</div><div class="line"> * &lt;pre&gt;</div><div class="line"> * 数据包格式</div><div class="line"> * +——----——+——-----——+——----——+——----——+——-----——+</div><div class="line"> * | 包头          | 模块号        | 命令号      |  长度        |   数据       |</div><div class="line"> * +——----——+——-----——+——----——+——----——+——-----——+</div><div class="line"> * &lt;/pre&gt;</div><div class="line"> * 包头4字节</div><div class="line"> * 模块号2字节short</div><div class="line"> * 命令号2字节short</div><div class="line"> * 长度4字节(描述数据部分字节长度)</div><div class="line"> */</div><div class="line">public class RequestDecoder extends FrameDecoder&#123;</div><div class="line">   /**</div><div class="line">    * 数据基本长度</div><div class="line">    */</div><div class="line">public static int BASE_LENGTH = 4+2+2+4;//包头+模块号+命令号+长度</div><div class="line"></div><div class="line">@Override</div><div class="line">protected Object decode(ChannelHandlerContext ctx, Channel channel,</div><div class="line">	ChannelBuffer buffer) throws Exception &#123;</div><div class="line">//记录包开头的index</div><div class="line">int beginIndex = buffer.readerIndex();</div><div class="line"></div><div class="line">//可读长度必须大于基本长度</div><div class="line">if(buffer.readableBytes()&gt;=BASE_LENGTH)&#123;</div><div class="line">	while(true)&#123;//循环读取,读到包头flag为止才可以真正读取数据</div><div class="line">		if(buffer.readInt()==Constants.FLAG)&#123;</div><div class="line">			break;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	//模块号</div><div class="line">	short module = buffer.readShort();</div><div class="line">	//命令号</div><div class="line">	short cmd = buffer.readShort();</div><div class="line">	//长度</div><div class="line">	int length = buffer.readInt();</div><div class="line">	</div><div class="line">	//现在可读长度小于数据长度,说明数据还没有读完</div><div class="line">	if(buffer.readableBytes()&lt;length)&#123;</div><div class="line">		//已经读取了12字节数据,现在的数据还没有来齐,所以还原读指针,返回空数据</div><div class="line">		buffer.readerIndex(beginIndex);</div><div class="line">		return null;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	//如果数据来全之后(按照长度读取)</div><div class="line">	byte[] data = new byte[length];</div><div class="line">	buffer.readBytes(data);</div><div class="line">	</div><div class="line">	//构建 buffer--&gt;request</div><div class="line">	Request request = new Request();</div><div class="line">	request.setModule(module);</div><div class="line">	request.setCmd(cmd);</div><div class="line">	request.setData(data);</div><div class="line">	</div><div class="line">	return request;</div><div class="line">	</div><div class="line">&#125;</div><div class="line">return null;</div><div class="line">   &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
</code></pre><h6 id="4-2-响应-Response"><a href="#4-2-响应-Response" class="headerlink" title="4.2 响应(Response)"></a>4.2 响应(Response)</h6><p>1.Response </p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line">   /**</div><div class="line"> * &lt;pre&gt;</div><div class="line"> * 数据包格式</div><div class="line"> * +——----——+——-----——+——----——+——----——+——-----——+</div><div class="line"> * | 包头	| 模块号  | 命令号 |  长度  |   数据  |</div><div class="line"> * +——----——+——-----——+——----——+——----——+——-----——+</div><div class="line"> * &lt;/pre&gt;</div><div class="line"> * 包头4字节</div><div class="line"> * 模块号2字节short</div><div class="line"> * 命令号2字节short</div><div class="line"> * 长度4字节(描述数据部分字节长度)</div><div class="line"> * 数据4字节</div><div class="line"> */</div><div class="line">   public class Response &#123;</div><div class="line">/**</div><div class="line"> * 状态码</div><div class="line"> */</div><div class="line">private int statusCode;</div><div class="line">/**</div><div class="line"> * 模块号</div><div class="line"> */</div><div class="line">private short module;</div><div class="line">/**</div><div class="line"> * 命令号</div><div class="line"> */</div><div class="line">private short cmd;</div><div class="line">/**</div><div class="line"> * 数据</div><div class="line"> */</div><div class="line">private byte[] data;</div><div class="line"></div><div class="line"></div><div class="line">public int getStatusCode() &#123;</div><div class="line">	return statusCode;</div><div class="line">&#125;</div><div class="line">public void setStatusCode(int statusCode) &#123;</div><div class="line">	this.statusCode = statusCode;</div><div class="line">&#125;</div><div class="line">public short getModule() &#123;</div><div class="line">	return module;</div><div class="line">&#125;</div><div class="line">public void setModule(short module) &#123;</div><div class="line">	this.module = module;</div><div class="line">&#125;</div><div class="line">public short getCmd() &#123;</div><div class="line">	return cmd;</div><div class="line">&#125;</div><div class="line">public void setCmd(short cmd) &#123;</div><div class="line">	this.cmd = cmd;</div><div class="line">&#125;</div><div class="line">public byte[] getData() &#123;</div><div class="line">	return data;</div><div class="line">&#125;</div><div class="line">public void setData(byte[] data) &#123;</div><div class="line">	this.data = data;</div><div class="line">&#125;</div><div class="line">/**</div><div class="line"> * 获取数据长度</div><div class="line"> */</div><div class="line">public int getDataLength()&#123;</div><div class="line">	if(this.data==null)&#123;</div><div class="line">		return 0;</div><div class="line">	&#125;</div><div class="line">	return this.data.length;</div><div class="line">&#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
</code></pre><p>2.ResponseEncoder</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">   import org.jboss.netty.buffer.ChannelBuffer;</div><div class="line">import org.jboss.netty.buffer.ChannelBuffers;</div><div class="line">import org.jboss.netty.channel.Channel;</div><div class="line">import org.jboss.netty.channel.ChannelHandlerContext;</div><div class="line">import org.jboss.netty.handler.codec.oneone.OneToOneEncoder;</div><div class="line">import com.cn.constants.Constants;</div><div class="line">import com.cn.model.Response;</div><div class="line">/**</div><div class="line"> * 请求编码器</div><div class="line"> * * &lt;pre&gt;</div><div class="line"> * 数据包格式</div><div class="line"> * +——----+——----+——----——+——----+——--------——+</div><div class="line"> * | 包头   |模块号    |命令号    |状态码  |长度  | 数据     |</div><div class="line"> * +——----+——----+——----——+——----+——--------——+</div><div class="line"> * &lt;/pre&gt;</div><div class="line"> * 包头4字节</div><div class="line"> * 模块号2字节short</div><div class="line"> * 命令号2字节short</div><div class="line"> * 长度4字节(描述数据部分字节长度)</div><div class="line"> * @author yxm</div><div class="line"> *</div><div class="line"> */</div><div class="line">   public class ResponseEncoder extends OneToOneEncoder&#123;</div><div class="line">@Override</div><div class="line">protected Object encode(ChannelHandlerContext ctx, Channel channel,</div><div class="line">		Object msg) throws Exception &#123;  </div><div class="line">	Response response = (Response)msg;</div><div class="line">	</div><div class="line">	ChannelBuffer buffer = ChannelBuffers.dynamicBuffer();</div><div class="line">	//包头   </div><div class="line">	buffer.writeInt(Constants.FLAG);</div><div class="line">	//模块号</div><div class="line">	buffer.writeShort(response.getModule());</div><div class="line">	//命令号  </div><div class="line">	buffer.writeShort(response.getCmd());</div><div class="line">	/**</div><div class="line">	 * 状态码</div><div class="line">	 */</div><div class="line">	buffer.writeInt(response.getStatusCode());</div><div class="line">	// 长度   </div><div class="line">	buffer.writeInt(response.getDataLength());</div><div class="line">	//数据(数据不为空,才读取到buffer)</div><div class="line">	if(response.getData()!=null)&#123;</div><div class="line">		buffer.writeBytes(response.getData());</div><div class="line">	&#125;</div><div class="line">	return buffer;</div><div class="line"> &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
</code></pre><p>3.ResponseDecoder  </p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line"> /**</div><div class="line"> * 请求解码器</div><div class="line"> * &lt;pre&gt;</div><div class="line"> * 数据包格式</div><div class="line">  +——----+——----+——----——+——----+——--------——+</div><div class="line"> * | 包头   |模块号    |命令号    |状态码  |长度  | 数据     |</div><div class="line"> * +——----+——----+——----——+——----+——--------——+</div><div class="line"> * &lt;/pre&gt;</div><div class="line"> * 包头4字节</div><div class="line"> * 模块号2字节short</div><div class="line"> * 命令号2字节short</div><div class="line"> * 长度4字节(描述数据部分字节长度)</div><div class="line"> */</div><div class="line">public class ResponseDecoder extends FrameDecoder&#123;</div><div class="line">   /**</div><div class="line">    * 数据基本长度</div><div class="line">    */</div><div class="line">public static int BASE_LENGTH = 4+2+2+4;//包头+模块号+命令号+长度</div><div class="line"></div><div class="line">   @Override</div><div class="line">   protected Object decode(ChannelHandlerContext ctx, Channel channel,</div><div class="line">	ChannelBuffer buffer) throws Exception &#123;</div><div class="line">//记录包开头的index</div><div class="line">int beginIndex = buffer.readerIndex();</div><div class="line"></div><div class="line">//可读长度必须大于基本长度</div><div class="line">if(buffer.readableBytes()&gt;=BASE_LENGTH)&#123;</div><div class="line">	while(true)&#123;//循环读取,读到包头flag为止才可以真正读取数据</div><div class="line">		if(buffer.readInt()==Constants.FLAG)&#123;</div><div class="line">			break;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	//模块号</div><div class="line">	short module = buffer.readShort();</div><div class="line">	//命令号</div><div class="line">	short cmd = buffer.readShort();</div><div class="line">	//状态码</div><div class="line">	int statusCode = buffer.readInt();</div><div class="line">	//长度</div><div class="line">	int length = buffer.readInt();</div><div class="line">	</div><div class="line">	//现在可读长度小于数据长度,说明数据还没有读完</div><div class="line">	if(buffer.readableBytes()&lt;length)&#123;</div><div class="line">		//已经读取了12字节数据,现在的数据还没有来齐,所以还原读指针,返回空数据</div><div class="line">		buffer.readerIndex(beginIndex);</div><div class="line">		return null;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	//如果数据来全之后(按照长度读取)</div><div class="line">	byte[] data = new byte[length];</div><div class="line">	buffer.readBytes(data);</div><div class="line">	</div><div class="line">	//构建 buffer--&gt;request</div><div class="line">	Response response = new Response();  </div><div class="line">	response.setModule(module);</div><div class="line">	response.setCmd(cmd);</div><div class="line">	response.setStatusCode(statusCode);</div><div class="line">	response.setData(data);</div><div class="line">	</div><div class="line">	return response;</div><div class="line">	</div><div class="line">&#125;</div><div class="line">return null;</div><div class="line">   &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
</code></pre><h6 id="4-3-其他"><a href="#4-3-其他" class="headerlink" title="4.3 其他"></a>4.3 其他</h6><p>1.Constants</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">   public class Constants &#123;</div><div class="line">/**</div><div class="line"> * 包头</div><div class="line"> */</div><div class="line">public static final int FLAG = -32521234;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
</code></pre><p>2.StatusCode</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">   public interface StatusCode &#123;</div><div class="line">public static int SUCCESS=1;//成功</div><div class="line">public static int FAIL=0;//失败</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
</code></pre><h5 id="5-项目测试"><a href="#5-项目测试" class="headerlink" title="5.项目测试"></a>5.项目测试</h5><p>修改之前的netty3客户端:<br>1.encoder:客户端编码是客户端请求的编码器<br>2.decoder:客户端解码是解码服务端返回的response对象<br>3.channel.write：是发送request对象</p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2017/11/26/netty实践-十-自定义数据包协议/" class="archive-article-date">
  	<time datetime="2017-11-26T12:31:43.000Z" itemprop="datePublished"><i class="icon-clock"></i>2017-11-26</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Netty/">Netty</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-java-枚举-enum" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/11/19/java-枚举-enum/">java-枚举(enum)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>enum 的全称为 enumeration， 是 JDK 1.5  中引入的新特性，存放在 java.lang 包中,继承java.lang.Enum  </p>
<ol>
<li><p>原始的接口定义常量</p>
</li>
<li><p>语法（定义）</p>
</li>
<li><p>遍历、switch 等常用操作</p>
</li>
<li><p>enum 对象的常用方法介绍</p>
</li>
<li><p>给 enum 自定义属性和方法</p>
</li>
<li><p>EnumSet，EnumMap 的应用</p>
</li>
<li><p>enum 的原理分析</p>
</li>
<li><p>总结</p>
</li>
</ol>
<h4 id="内容"><a href="#内容" class="headerlink" title="内容"></a>内容</h4><h5 id="1-原始的接口定义常量"><a href="#1-原始的接口定义常量" class="headerlink" title="1. 原始的接口定义常量"></a>1. 原始的接口定义常量</h5><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">public interface IConstants&#123;</div><div class="line">   String MON=&quot;mon&quot;;</div><div class="line">   String TUE=&quot;tue&quot;;</div><div class="line">   String WED=&quot;wed&quot;;</div><div class="line">   String THU=&quot;thu&quot;;</div><div class="line">   String FRI=&quot;fri&quot;;</div><div class="line">   String SAT=&quot;sat&quot;;</div><div class="line">   String  SUN=&quot;sun&quot;;       </div><div class="line">&#125;</div></pre></td></tr></table></figure>
</code></pre><h5 id="2-语法（定义）"><a href="#2-语法（定义）" class="headerlink" title="2. 语法（定义）"></a>2. 语法（定义）</h5><ol>
<li>创建枚举类要 使用enum关键字,隐藏了所有类的创建都是java.lang.Enum的子类型(java.lang.Enum是一个抽象类)</li>
<li>枚举类型符合通用模式 Class Enum<e extends="" enum<e="">&gt;，而 E 表示枚举类型的名称。</e></li>
<li>枚举类型的每一个值都将映射到 protected Enum(String name, int ordinal)构造函数中，在这里，每个值的名称都被转换成一个字符串，并且序数设置表示了此设置被创建的顺序。</li>
</ol>
<p>例如:  </p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"> public enum Week&#123;</div><div class="line">    MON,TUE, WED,THU,FRI,SAT,SUN</div><div class="line">&#125;</div><div class="line">注意:实例后面没有分号</div><div class="line"></div><div class="line">这段代码实际上调用了7次Enum(String name,int ordinal);</div><div class="line">new Enum(&quot;MON&quot;,1);</div><div class="line">new Enum(&quot;TUE&quot;,2);</div><div class="line">new Enum(&quot;WED&quot;,3);</div><div class="line">...</div></pre></td></tr></table></figure>
</code></pre><h5 id="3-遍历、switch-等常用操作"><a href="#3-遍历、switch-等常用操作" class="headerlink" title="3. 遍历、switch 等常用操作"></a>3. 遍历、switch 等常用操作</h5><p>对enum进行遍历和switch的操作示例代码：</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">  public class EnumTest &#123;</div><div class="line">public static  void main(String[] args)&#123;</div><div class="line"> //for循环遍历</div><div class="line"> for(Week week:Week.values())&#123;</div><div class="line">	 System.out.println(week.name()+&quot; &quot;+week.ordinal());</div><div class="line"> &#125;</div><div class="line"> </div><div class="line"> //switch遍历</div><div class="line"> Week option = Week.TUE;</div><div class="line"> switch(option)&#123;</div><div class="line"> case MON:</div><div class="line">	  System.out.println(&quot;今天周一&quot;);</div><div class="line">	 break;</div><div class="line"> case TUE:</div><div class="line">	 System.out.println(&quot;今天周二&quot;);</div><div class="line">	 break;</div><div class="line"> case WED:</div><div class="line">	 System.out.println(&quot;今天周三&quot;);</div><div class="line">	 break;</div><div class="line"> case THU:</div><div class="line">	 System.out.println(&quot;今天周四&quot;);</div><div class="line">	 break;</div><div class="line"> default:</div><div class="line">           System.out.println(option);</div><div class="line">          break;</div><div class="line"> &#125;</div><div class="line"> </div><div class="line">&#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
</code></pre><p>输出:  </p>
<p>MON 0<br>TUE 1<br>WED 2<br>THU 3<br>FRI 4<br>SAT 5<br>SUN 6<br>今天周二  </p>
<h5 id="4-enum-对象的常用方法介绍"><a href="#4-enum-对象的常用方法介绍" class="headerlink" title="4. enum 对象的常用方法介绍"></a>4. enum 对象的常用方法介绍</h5><p>int compareTo(E o) //比较此枚举与指定对象的顺序。</p>
<p>Class<e> getDeclaringClass()  返回与此枚举常量的枚举类型相对应的 Class 对象。</e></p>
<p>String name()  返回此枚举常量的名称，在其枚举声明中对其进行声明。</p>
<p>int ordinal()  返回枚举常量的序数（它在枚举声明中的位置，其中初始常量序数为零）。</p>
<p>String toString() 返回枚举常量的名称，它包含在声明中。</p>
<p>static <t extends="" enum<t="">&gt; T valueOf(Class<t> enumType, String name)  返回带指定名称的指定枚举类型的枚举常量。</t></t></p>
<h5 id="5-给-enum-自定义属性和方法"><a href="#5-给-enum-自定义属性和方法" class="headerlink" title="5. 给 enum 自定义属性和方法"></a>5. 给 enum 自定义属性和方法</h5><p>给 enum 对象加一下 value 的属性和 getValue() 的方法：</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">public enum EnumTest &#123;</div><div class="line">MON(1), TUE(2), WED(3), THU(4), FRI(5), SAT(6) &#123;</div><div class="line">    @Override</div><div class="line">    public boolean isRest() &#123;</div><div class="line">        return true;</div><div class="line">    &#125;</div><div class="line">&#125;,</div><div class="line">SUN(0) &#123;</div><div class="line">    @Override</div><div class="line">    public boolean isRest() &#123;</div><div class="line">        return true;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"> </div><div class="line">private int value;</div><div class="line"> </div><div class="line">private EnumTest(int value) &#123;</div><div class="line">    this.value = value;</div><div class="line">&#125;</div><div class="line"> </div><div class="line">public int getValue() &#123;</div><div class="line">    return value;</div><div class="line">&#125;</div><div class="line"> </div><div class="line">public boolean isRest() &#123;</div><div class="line">    return false;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">public class Test &#123;</div><div class="line">public static void main(String[] args) &#123;</div><div class="line">    System.out.println(&quot;EnumTest.FRI 的 value = &quot; + EnumTest.FRI.getValue());</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</code></pre><p>输出:<br>EnumTest.FRI 的 value = 5</p>
<h5 id="6-EnumSet，EnumMap-的应用"><a href="#6-EnumSet，EnumMap-的应用" class="headerlink" title="6. EnumSet，EnumMap 的应用"></a>6. EnumSet，EnumMap 的应用</h5><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">public class Test &#123;</div><div class="line">public static void main(String[] args) &#123;</div><div class="line">    // EnumSet的使用</div><div class="line">    EnumSet&lt;EnumTest&gt; weekSet = EnumSet.allOf(EnumTest.class);</div><div class="line">    for (EnumTest day : weekSet) &#123;</div><div class="line">        System.out.println(day);</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    // EnumMap的使用</div><div class="line">    EnumMap&lt;EnumTest, String&gt; weekMap = new EnumMap(EnumTest.class);</div><div class="line">    weekMap.put(EnumTest.MON, &quot;星期一&quot;);</div><div class="line">    weekMap.put(EnumTest.TUE, &quot;星期二&quot;);</div><div class="line">    // ... ...</div><div class="line">    for (Iterator&lt;Entry&lt;EnumTest, String&gt;&gt; iter = weekMap.entrySet().iterator(); iter.hasNext();) &#123;</div><div class="line">        Entry&lt;EnumTest, String&gt; entry = iter.next();</div><div class="line">        System.out.println(entry.getKey().name() + &quot;:&quot; + entry.getValue());</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</code></pre><h5 id="7-enum-的原理分析"><a href="#7-enum-的原理分析" class="headerlink" title="7. enum 的原理分析"></a>7. enum 的原理分析</h5><p> enum 的语法结构尽管和 class 的语法不一样，但是经过编译器编译之后产生的是一个class文件。该class文件经过反编译可以看到实际上是生成了一个类，该类继承了java.lang.Enum<e>。EnumTest 经过反编译(javap com.hmw.test.EnumTest 命令)之后得到的内容如下：</e></p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">public class com.hmw.test.EnumTest extends java.lang.Enum&#123;</div><div class="line">public static final com.hmw.test.EnumTest MON;</div><div class="line">public static final com.hmw.test.EnumTest TUE;</div><div class="line">public static final com.hmw.test.EnumTest WED;</div><div class="line">public static final com.hmw.test.EnumTest THU;</div><div class="line">public static final com.hmw.test.EnumTest FRI;</div><div class="line">public static final com.hmw.test.EnumTest SAT;</div><div class="line">public static final com.hmw.test.EnumTest SUN;</div><div class="line">static &#123;&#125;;</div><div class="line">public int getValue();</div><div class="line">public boolean isRest();</div><div class="line">public static com.hmw.test.EnumTest[] values();</div><div class="line">public static com.hmw.test.EnumTest valueOf(java.lang.String);</div><div class="line">com.hmw.test.EnumTest(java.lang.String, int, int, com.hmw.test.EnumTest);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</code></pre><p>所以，实际上 enum 就是一个 class，只不过 java 编译器帮我们做了语法的解析和编译而已。  </p>
<h5 id="8-总结"><a href="#8-总结" class="headerlink" title="8. 总结"></a>8. 总结</h5><ol>
<li>可以把 enum 看成是一个普通的 class，它们都可以定义一些属性和方法，不同之处是：enum 不能使用 extends 关键字继承其他类，因为 enum 已经继承了 java.lang.Enum（java是单一继承）。  </li>
<li>枚举的本质是类，在没有枚举之前，仍然可以按照java最基本的编程手段来解决需要用到枚举的地方。</li>
<li>枚举屏蔽了枚举值的类型信息，不像在用public static final定义变量必须指定类型。枚举是用来构建常量数据结构的模板，这个模板可扩展。</li>
<li>枚举的使用增强了程序的健壮性，比如在引用一个不存在的枚举值的时候，编译器会报错。</li>
</ol>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2017/11/19/java-枚举-enum/" class="archive-article-date">
  	<time datetime="2017-11-19T05:28:59.000Z" itemprop="datePublished"><i class="icon-clock"></i>2017-11-19</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javaSE/">javaSE</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-vue-26-vue工程实例-前端开发" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/11/11/vue-26-vue工程实例-前端开发/">vue(26)-vue工程实例-前端开发</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>src 目录里面就是我们主要的前端开发文件，由于脚手架采用了vue-loader，就可以把<br>组件抽象成一个.vue 文件，并把所需的样式和DOM 结构都放在一起。我们以一个登录实例<br>来展示整体的开发情况。  </p>
<p>目录情况如下:  </p>
<p><img src="https://raw.githubusercontent.com/startshineye/img/master/2017/11/27.png" alt=""></p>
<p>index.html代码如下:  </p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"> &lt;!DOCTYPE html&gt;</div><div class="line"> &lt;html&gt;</div><div class="line">   &lt;head&gt;</div><div class="line">    &lt;meta charset=&quot;utf-8&quot;&gt;</div><div class="line">    &lt;title&gt;my-project&lt;/title&gt;</div><div class="line">  &lt;/head&gt;</div><div class="line">  &lt;body&gt;</div><div class="line"> &lt;div id=&quot;app&quot;&gt;</div><div class="line"> &lt;router-view&gt;&lt;/router-view&gt;</div><div class="line">&lt;/div&gt;</div><div class="line"> &lt;/body&gt;</div><div class="line"> &lt;/html&gt;</div></pre></td></tr></table></figure>
</code></pre><p>./src/main.js 代码如下：</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">   import Vue from &apos;vue&apos;</div><div class="line">//vue插件</div><div class="line">import VueRouter from &apos;vue-router&apos;</div><div class="line">//组件</div><div class="line">import Main from &apos;./components/Main.vue&apos;</div><div class="line">import Login from &apos;./components/Login.vue&apos;</div><div class="line"></div><div class="line">Vue.use(VueRouter)</div><div class="line"></div><div class="line">var router=new VueRouter(&#123;</div><div class="line">&#125;)</div><div class="line"></div><div class="line">router.map(&#123;</div><div class="line">  &apos;/&apos;:&#123;</div><div class="line">    name:&apos;main&apos;,</div><div class="line">    component:Main</div><div class="line">  &#125;,</div><div class="line">  &apos;/login&apos;:&#123;</div><div class="line">    name:&apos;login&apos;,</div><div class="line">    component:Login</div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line">var App = Vue.extend(&#123;&#125;)</div><div class="line">router.start(App,&quot;#app&quot;)</div></pre></td></tr></table></figure>
</code></pre><p>components/Login.vue:  </p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line">   &lt;template&gt;</div><div class="line">   &lt;div class=&quot;login&quot;&gt;</div><div class="line">    &lt;div class = &quot;input-wrap&quot;&gt;</div><div class="line">        &lt;input type=&quot;text&quot; v-model=&quot;name&quot;/&gt;</div><div class="line">         &lt;span v-if=&quot;error.name&quot; class = &quot;error-msg&quot;&gt;</div><div class="line">            &#123;&#123;error.name&#125;&#125;</div><div class="line">         &lt;/span&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line"></div><div class="line">   &lt;div class = &quot;input-wrap&quot;&gt;</div><div class="line">       &lt;input type=&quot;password&quot; v-model=&quot;pwd&quot;/&gt;</div><div class="line">        &lt;span v-if=&quot;error.pwd&quot; class=&quot;err-msg&quot;&gt;&#123;&#123;error.pwd&#125;&#125;&lt;/span&gt;</div><div class="line">   &lt;/div&gt;</div><div class="line"></div><div class="line">   &lt;div class=&quot;input-wrap&quot;&gt;</div><div class="line">       &lt;button @click=&quot;login&quot;&gt;提交&lt;/button&gt;</div><div class="line">   &lt;/div&gt;</div><div class="line">  &lt;/div&gt;</div><div class="line">&lt;/template&gt;</div><div class="line"></div><div class="line">&lt;script&gt;</div><div class="line">export default&#123;</div><div class="line">  data()&#123;</div><div class="line">   return&#123;</div><div class="line">     name:&apos;&apos;,</div><div class="line">     pwd:&apos;&apos;,</div><div class="line">     error:&#123;</div><div class="line">       name:&apos;&apos;,</div><div class="line">       pwd:&apos;&apos;</div><div class="line">     &#125;</div><div class="line">   &#125;</div><div class="line">   &#125;,</div><div class="line">   methods:&#123;</div><div class="line">   chech(name,pwd)&#123;</div><div class="line">     if(!name)&#123;</div><div class="line">       this.error.name=&apos;请输入姓名...&apos;;</div><div class="line">       return false;</div><div class="line">     &#125;</div><div class="line">     if(!pwd)&#123;</div><div class="line">       this.error.name = &apos;请输入密码...&apos;;</div><div class="line">       return false;</div><div class="line">     &#125;</div><div class="line">     return true;</div><div class="line">   &#125;,</div><div class="line">   login()&#123;</div><div class="line">     const &#123;name,pwd,$router&#125;=this;</div><div class="line">     if(!this.chech(name,pwd)) return;</div><div class="line">     if(name==&apos;admin&apos; &amp;&amp; pwd==123)&#123;</div><div class="line">         $router.go(&#123;name:&apos;admin&apos;&#125;);</div><div class="line">     &#125;else&#123;</div><div class="line">       alert(&apos;用户名密码错误&apos;);</div><div class="line">     &#125;</div><div class="line">   &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">&lt;/script&gt;</div><div class="line">&lt;style scoped lang=&quot;scss&quot;&gt;</div><div class="line">  .login&#123;</div><div class="line">   width:300px;</div><div class="line">   margin:10% auto;</div><div class="line">   &#125;</div><div class="line">   &lt;/style&gt;</div></pre></td></tr></table></figure>
</code></pre><p>需要注意的是在style 标签中使用了lang=“scss”这样的属性，也就说此处的写法是需<br>要符合scss 规范的，而且我们需要在webpack 的配置中加上sass 的loader 用来编译这段样<br>式。vue-cli 默认的配置中并没有安装sass-loader, 所以需要自己手动安装一下 npm install<br>sass-loader-dev-save。</p>
<p>在build/webpack.base.conf.js 中，vue-loader 配置了所有的CSS 的loader 处理器</p>
<p><img src="https://raw.githubusercontent.com/startshineye/img/master/2017/11/28.png" alt="">  </p>
<p>引用的是build/utils 中的方法  </p>
<p><img src="https://raw.githubusercontent.com/startshineye/img/master/2017/11/29.png" alt="">   </p>
<p>所以如果用的是其他CSS 预处理工具，也只需要安装不同的预处理loader 即可，基本不<br>用修改里面的webpack 配置。  </p>
<p>./src/components/main.vue  </p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">&lt;template&gt;</div><div class="line"> &lt;div clas=&quot;main&quot;&gt;</div><div class="line">&lt;h1&gt;&#123;&#123;msg&#125;&#125;&lt;/h1&gt;</div><div class="line"> &lt;/div&gt;</div><div class="line">&lt;/template&gt;</div><div class="line">&lt;script&gt;</div><div class="line">export default &#123;</div><div class="line">data()&#123;</div><div class="line">  return&#123;</div><div class="line">    msg:&apos;Welcome to the Vue.js&apos;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&lt;/script&gt;</div><div class="line">&lt;style&gt;</div><div class="line">.main&#123;</div><div class="line">font-size: 14px;</div><div class="line">color: #00d6b2;</div><div class="line">background-color:#1c2b36;</div><div class="line">&#125;</div><div class="line">&lt;/style&gt;</div></pre></td></tr></table></figure>
</code></pre><p>这样一个基本的登录校验及跳转主页面的功能就完成了，实际的效果与url 路径如下。<br>登录页面:  </p>
<p><img src="https://raw.githubusercontent.com/startshineye/img/master/2017/11/30.png" alt="">  </p>
<p>错误提示页面:  </p>
<p><img src="https://raw.githubusercontent.com/startshineye/img/master/2017/11/31.png" alt=""></p>
<p>输入admin、123 成功跳转:<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2017/11/32.png" alt=""></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2017/11/11/vue-26-vue工程实例-前端开发/" class="archive-article-date">
  	<time datetime="2017-11-11T02:58:03.000Z" itemprop="datePublished"><i class="icon-clock"></i>2017-11-11</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Vue-js-前端开发-快速入门与专业应用/">Vue.js+前端开发+快速入门与专业应用</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-nodejs-使用nodeJs安装vue-cli" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/11/11/nodejs-使用nodeJs安装vue-cli/">nodejs-使用nodeJs安装vue-cli</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><ol>
<li><p>Node.js 就是运行在服务端的 JavaScript，</p>
</li>
<li><p>Node.js是一个事件驱动I/O服务端JavaScript环境，基于Google的V8引擎，V8引擎执行Javascript的速度非常快，性能非常好。</p>
</li>
</ol>
<h4 id="内容"><a href="#内容" class="headerlink" title="内容"></a>内容</h4><p>1.安装node,node自带npm,cmd后：npm install -g vue-cli<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2017/11/18.png" alt="">  </p>
<p>2.安装后，检查是否安装成功（显示版本则安装成功(vue -V）注意必须是大写<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2017/11/19.png" alt="">  </p>
<p>3.使用vue建一个项目名叫my-project（vue init webpack my-project）<br>注：vue-cli 的模板包括 webpack 和 webpack-simple,前者是比较复杂专业的项目，他的配置并不全放在根目录下的 webpack.config.js 中。<br>webpack-simple 相对简单的，它根目录下才有个 webpack.config.js。<br>项目建立过程中，有如下选择，选择NO。（该选项为使用ESLint规范你的代码，一个空格错误都将报错，不开启，可以避免不必要的麻烦）<br>ESLint规范建议开启，加强代码规范  </p>
<p><img src="https://raw.githubusercontent.com/startshineye/img/master/2017/11/20.png" alt=""></p>
<p><img src="https://raw.githubusercontent.com/startshineye/img/master/2017/11/21.png" alt="">  </p>
<p>4.建立项目后,进入my-project安装项目依赖npm install<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2017/11/22.png" alt="">  </p>
<p>5.进入项目目录文件my-project中，就可以使用vue进行开发啦<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2017/11/23.png" alt=""></p>
<p>6.使用npm run dev，便可以打开本地服务器实时查看效果（localhost:8080）<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2017/11/24.png" alt=""><br><img src="https://raw.githubusercontent.com/startshineye/img/master/2017/11/25.png" alt=""></p>
<p>7.10，退出监听，可以直接Ctrl+C</p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2017/11/11/nodejs-使用nodeJs安装vue-cli/" class="archive-article-date">
  	<time datetime="2017-11-11T01:57:53.000Z" itemprop="datePublished"><i class="icon-clock"></i>2017-11-11</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nodeJs/">nodeJs</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-vue-25-vue工程实例-项目结构" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/11/11/vue-25-vue工程实例-项目结构/">vue(25)-vue工程实例-项目结构</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><ol>
<li>Vue.js 有一款官方的脚手架生成工具vue-cli，可以通过npm install –g vue-cli 进行全局安装  </li>
</ol>
<h4 id="内容"><a href="#内容" class="headerlink" title="内容"></a>内容</h4><p>vue提供的 5种脚本手架(即可使用的<template-name>)  </template-name></p>
<p>1.webpack:基于webpack 和vue-loader 的目录结构，而且支持热部署、代码检查、测试及css 抽取。<br>2.webpack-simple ：基于webpack 和vue-loader 的目录结构。<br>3.browerify：基于Browerfiy 和vueify（作用于vue-loader 类似）的结构，支持热部署、代码检查及单元测试。<br>4.browerify-simple ：基于Browerfiy 和vueify 的结构。<br>5.simple ：单个引入Vue.js 的index.html 页面。  </p>
<p>这里我们主要会使用webpack 作为常用脚手架， 可以运行vue init webpack myproject来生成项目。如图8-2 所示。<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2017/11/20.png" alt=""></p>
<p>生成的目录结构  </p>
<p><img src="https://raw.githubusercontent.com/startshineye/img/master/2017/11/21.png" alt="">  </p>
<p>build: 用于存放webpack 相关配置和脚本。<br>config: 主要存放配置文件，用于区分开发环境、测试环境、线上环境的不同。<br>src: 项目源码及需要引用的资源文件。<br>static: 不需要webpack 处理的静态资源。<br>test: 用于存放测试文件。  </p>
<p>从package.json 中，我们可以看到项目支持的命令有：  </p>
<p><img src="https://raw.githubusercontent.com/startshineye/img/master/2017/11/26.png" alt="">  </p>
<p>正常开发时，就会运行命令npm run dev，启动一个小型的express 服务。在这个<br>express 服务中，会使用webpack-dev-middleware 和webpack-hot-middleware 这两个<br>中间件，来进行项目的热部署，即每次修改src 中的文件后，不需要再按浏览器的刷新来更新<br>代码，启动的server 服务会自动监听文件的变化并编译，通知浏览器自动刷新。</p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2017/11/11/vue-25-vue工程实例-项目结构/" class="archive-article-date">
  	<time datetime="2017-11-11T01:51:33.000Z" itemprop="datePublished"><i class="icon-clock"></i>2017-11-11</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Vue-js-前端开发-快速入门与专业应用/">Vue.js+前端开发+快速入门与专业应用</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-vue-24-vue工程实例-准备vue-loader" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/11/10/vue-24-vue工程实例-准备vue-loader/">vue(24)-vue工程实例-准备vue.loader</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>1.vue-loader 是webpack 的一个loader 加载器，用于处理我们编写的.vue 文件。在早<br>期进行组件化编写时，我们往往会把一个组件的html、css、js 放在三个不同的文件中，然后<br>利用编译工具再合到一起。这样产生的不便就是文件过多，修改一个组件需要打开三个文件，<br>开发的过程中经常需要不断地切换视窗。然而vue-loader 的出现，使得我们能将一个组件的<br>html、css、js 放在一个文件中，用不同的标签包裹住即可。</p>
<p>2.vue-loader 会将这三块代码分别编译成可执行的代码。</p>
<h4 id="内容"><a href="#内容" class="headerlink" title="内容"></a>内容</h4><ol>
<li><p>使用之前，需要先按照vue-loader，以及所需要的用作编译的其他loader。  </p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">webpack webpack-dev-server vue-loader vue-html-loader css-loader vue-style-loader vue-hot-reload-api babel-loader babel-core babel-plugin-transform-runtime babel-preset-es2015 babel-runtime --save-dev</div></pre></td></tr></table></figure>
</li>
<li><p>我们可以这样编写.vue 文件：<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2017/11/16.png" alt=""></p>
</li>
</ol>
<p>1.template 标签中的即为该组件的DOM 结构，默认采用HTML 形式，每个.vue 文件中最多只能包含一个template 标签。<br>2.由于template 采用的模板引擎是consolidate.js(https://<br>github.com/tj/consolidate.js)，支持大部分的模板语法，我们可以通过配置template 的lang属性，使用不同的模板语法:</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;template lang=&quot;jade&quot;&gt;</div><div class="line">ul. </div><div class="line"> li</div><div class="line">   a(v-link=&quot;&#123; name : &apos;home&apos; &#125;&quot;) 首页</div><div class="line"> li</div><div class="line">   a(v-link=&quot;&#123; name : &apos;list&apos; &#125;&quot;) 列表页</div><div class="line">&lt;/template&gt;</div></pre></td></tr></table></figure>
</code></pre><p>3.script 标签中即为该组件的js 代码，且同template 一样，一个.vue 文件中最多只能包<br>含一个script 标签而且最终必须输出（export）一个符合Vue.extend() 参数规范的对象，<br>用于建立Vue 组件构建器。例如上例中export default 输出的对象。</p>
<p>4.style 标签即为该组件的CSS 代码，同个vue 文件中可以包含多个style 标签。除了直<br>接使用CSS 写法外，还可以通过配置loader，支持sass、less 等样式写法。另外还有一个<br>scoped 属性，添加之后，vue-loader 会把当前同.vue 文件template 中的DOM 都添加一个_v….. 的属性，，并把style 中的样式也加上对应的属性选择器，使得这部分样式仅在当前vue 的DOM 中生效。这个方式使得组件间的样式不会互相冲突，也不需要过长的命名来维护。例如： </p>
<pre><code>```
&lt;style scoped&gt;
ul {
　 display: flex;
}
ul li {
　 list-style: none;
　 flex:1;
}
&lt;/style&gt;
&lt;template&gt;
　 &lt;ul&gt;
　　 &lt;li&gt;&lt;a v-link=&quot;{ name : &apos;home&apos;}&quot;&gt; 首页&lt;/a&gt;&lt;/li&gt;
　　 &lt;li&gt;&lt;a v-link=&quot;{ name : &apos;list&apos;}&quot;&gt; 列表页&lt;/a&gt;&lt;/li&gt;
　 &lt;/ul&gt;
&lt;/template&gt;
``` 
</code></pre><p><img src="https://raw.githubusercontent.com/startshineye/img/master/2017/11/17.png" alt=""></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2017/11/10/vue-24-vue工程实例-准备vue-loader/" class="archive-article-date">
  	<time datetime="2017-11-10T12:30:59.000Z" itemprop="datePublished"><i class="icon-clock"></i>2017-11-10</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Vue-js-前端开发-快速入门与专业应用/">Vue.js+前端开发+快速入门与专业应用</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-vue-23-vue工程实例-准备" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/11/10/vue-23-vue工程实例-准备/">vue(23)-vue工程实例-准备</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><h4 id="内容"><a href="#内容" class="headerlink" title="内容"></a>内容</h4><h5 id="1-webpack"><a href="#1-webpack" class="headerlink" title="1.webpack"></a>1.webpack</h5><ol>
<li>webpack 是一款模块加载及处理工具，它能把各种资源，例如JS（含JSX）、coffee、样式（含less/sass）、图片等都作为模块来使用和处理</li>
<li>webpack 可以把ES6 语法的js 文件，sass 样式等无法直接在浏览器中使用的语言编译成浏览器支持的形式，也可以把需要的文件进行合并、压缩混淆。<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2017/11/5.png" alt=""></li>
</ol>
<h6 id="1-1-安装webpack"><a href="#1-1-安装webpack" class="headerlink" title="1.1 安装webpack"></a>1.1 安装webpack</h6><p>在安装 Webpack 前，你本地环境需要支持 node.js。<br>由于 npm 安装速度慢,使用淘宝的镜像及其命令 cnpm</p>
<pre><code>cnpm install webpack -g
</code></pre><p><img src="https://raw.githubusercontent.com/startshineye/img/master/2017/11/6.png" alt="">  </p>
<h6 id="1-2-创建项目"><a href="#1-2-创建项目" class="headerlink" title="1.2 创建项目"></a>1.2 创建项目</h6><p>1.创建一个目录 app<br>2.app下创建app.js文件,内容为:  </p>
<pre><code>document.write(&quot;It works.&quot;);
</code></pre><p>3.app下创建index.html文件,内容如下:</p>
<pre><code>&lt;html&gt;
  &lt;head&gt;
 &lt;meta charset = &quot;utf-8&quot;&gt;
 &lt;script src=&quot;bundle.js&quot;&gt;&lt;/script&gt;
&lt;/head&gt;
 &lt;body&gt;&lt;/body&gt;
&lt;/html&gt;
</code></pre><p>4.接下来我们使用 webpack 命令来打包<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2017/11/7.png" alt=""></p>
<p>5.浏览器中访问<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2017/11/8.png" alt=""></p>
<h6 id="1-3-创建第二个JS文件"><a href="#1-3-创建第二个JS文件" class="headerlink" title="1.3 创建第二个JS文件"></a>1.3 创建第二个JS文件</h6><p>接下来我们创建另外一个js文件app2.js，代码如下：  </p>
<pre><code>module.exports=&quot;It works from app2.js&quot;
</code></pre><p>更新app.js文件，代码如下：  </p>
<pre><code>document.write(require(&quot;./app2.js&quot;));  
</code></pre><p>接下来我们使用 webpack 命令来打包：</p>
<pre><code>webpack app.js bundle..js  
</code></pre><p><img src="https://raw.githubusercontent.com/startshineye/img/master/2017/11/9.png" alt="">  </p>
<p>exports和module.exports指向同一块内存，但require()返回的是module.exports而不是exports。</p>
<p>在浏览器访问，输出结果如下所示：  </p>
<p> It works from app2.js</p>
<p>webpack 根据模块的依赖关系进行静态分析，这些文件(模块)会被包含到 bundle.js 文件中。Webpack 会给每个模块分配一个唯一的 id 并通过这个 id 索引和访问模块。 在页面启动时，会先执行app.js 中的代码，其它模块会在运行 require 的时候再执行。</p>
<h6 id="1-4-loader"><a href="#1-4-loader" class="headerlink" title="1.4 loader"></a>1.4 loader</h6><p>1.Webpack本身只能处理JavaScript模块，如果要处理其他类型的文件，就需要使用loader进行转换。<br>2.如果我们需要在应用中添加 css 文件，就需要使用到 css-loader 和 style-loader，他们做两件不同的事情，css-loader 会遍历 CSS 文件，然后找到 url() 表达式然后处理他们，style-loader 会把原来的 CSS 代码插入页面中的一个 style 标签中。  </p>
<p>使用以下命令来安装 css-loader 和 style-loader(全局安装需要参数 -g):  </p>
<p>执行以上命令后，会再当前目录生成 node_modules 目录，它就是 css-loader 和 style-loader 的安装目录。<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2017/11/10.png" alt="">    </p>
<p>接下来创建一个 style.css 文件，代码如下：  </p>
<pre><code>body{
  background:yellow;
}
</code></pre><p>修改app.js文件,代码如下:  </p>
<pre><code>require(&quot;!style-loader!css-loader!./style.css&quot;);
document.write(require(&quot;./app2.js&quot;));
</code></pre><p>接下来我们使用 webpack 命令来打包：<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2017/11/11.png" alt=""></p>
<p>在浏览器访问，输出结果如下所示：<br><img src="https://raw.githubusercontent.com/startshineye/img/master/2017/11/12.png" alt=""></p>
<p>require CSS 文件的时候都要写 loader 前缀 !style-loader!css-loader!，当然我们可以根据模块类型（扩展名）来自动绑定需要的 loader。 将app.js 中的 require(“!style-loader!css-loader!./style.css”) 修改为 require(“./style.css”)，效果一样</p>
<h6 id="1-5-配置文件"><a href="#1-5-配置文件" class="headerlink" title="1.5 配置文件"></a>1.5 配置文件</h6><p>我们可以将一些编译选项放在配置文件中，以便于统一管理：<br>创建webpack.config.js文件,代码如下:  </p>
<pre><code>module.exports={
entry:&quot;./app.js&quot;,
output:{
    path:__dirname,//注意此处是两个下划线
    filename:&quot;bundle.js&quot;
},
module:{
    loaders:[
    { test: /\.css$/, loader: &quot;style-loader!css-loader&quot; }
    ]
}
}
</code></pre><p>接下来我们只需要执行 webpack 命令即可生成 bundle.js 文件：  </p>
<p><img src="https://raw.githubusercontent.com/startshineye/img/master/2017/11/13.png" alt=""><br>webpack 命令执行后，会默认载入当前目录的 webpack.config.js 文件。</p>
<h6 id="1-6-插件"><a href="#1-6-插件" class="headerlink" title="1.6 插件"></a>1.6 插件</h6><p>插件在 webpack 的配置信息 plugins 选项中指定，用于完成一些 loader 不能完成的工。webpack 自带一些插件，你可以通过 cnpm 安装一些插件。使用内置插件需要通过以下命令来安装：</p>
<p>使用内置插件需要通过以下命令来安装：</p>
<pre><code>cnpm install webpack --save-dev
</code></pre><p>比如我们可以安装内置的 BannerPlugin 插件，用于在文件头部输出一些注释信息。  </p>
<p>修改 webpack.config.js，代码如下：</p>
<pre><code>var webpack=require(&apos;webpack&apos;);
module.exports = {
entry: &quot;./runoob1.js&quot;,
output: {
    path: __dirname,
    filename: &quot;bundle.js&quot;
},
module: {
    loaders: [
        { test: /\.css$/, loader: &quot;style-loader!css-loader&quot; }
    ]
},
plugins:[
new webpack.BannerPlugin(&apos;菜鸟教程 webpack 实例&apos;)
]
};
</code></pre><p>然后运行:  </p>
<p>webpack  </p>
<p>当项目逐渐变大，webpack 的编译时间会变长，可以通过参数让编译的输出内容带有进度和颜色。  </p>
<pre><code>webpack --progress --colors
</code></pre><p>如果不想每次修改模块后都重新编译，那么可以启动监听模式。开启监听模式后，没有变化的模块会在编译后缓存到内存中，而不会每次都被重新编译，所以监听模式的整体速度是很快的。</p>
<pre><code>webpack --progress --colors --watch
</code></pre><p>当然，我们可以使用 webpack-dev-server 开发服务，这样我们就能通过 localhost:8080 启动一个 express 静态资源 web 服务器，并且会以监听模式自动运行 webpack，在浏览器打开 <a href="http://localhost:8080/" target="_blank" rel="external">http://localhost:8080/</a> 或 <a href="http://localhost:8080/webpack-dev-server/" target="_blank" rel="external">http://localhost:8080/webpack-dev-server/</a> 可以浏览项目中的页面和编译后的资源输出，并且通过一个 socket.io 服务实时监听它们的变化并自动刷新页面。</p>
<p>1、安装<br>cnpm install webpack-dev-server -g</p>
<p>2、运行<br>webpack-dev-server –progress –colors</p>
<p>在浏览器打开 <a href="http://localhost:8080/" target="_blank" rel="external">http://localhost:8080/</a> </p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2017/11/10/vue-23-vue工程实例-准备/" class="archive-article-date">
  	<time datetime="2017-11-10T09:17:35.000Z" itemprop="datePublished"><i class="icon-clock"></i>2017-11-10</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Vue-js-前端开发-快速入门与专业应用/">Vue.js+前端开发+快速入门与专业应用</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-vue-22-组件-动态组件" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/11/10/vue-22-组件-动态组件/">vue(22)-组件-动态组件</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>Vue.js 支持动态组件，即多个组件可以使用同一挂载点，根据条件来切换不同的组件。<br>使用保留标签<component>，通过绑定到is 属性的值来判断挂载哪个组件。这种场景往往运<br>用在路由控制或者tab 切换中</component></p>
<h4 id="内容"><a href="#内容" class="headerlink" title="内容"></a>内容</h4><h5 id="1-基础用法"><a href="#1-基础用法" class="headerlink" title="1.基础用法"></a>1.基础用法</h5><p>页面切换说明动态组件基础用法。  </p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">&lt;!--js--&gt;</div><div class="line">&lt;div id=&quot;app&quot;&gt;</div><div class="line">   &lt;ul&gt;</div><div class="line">       &lt;li @click=&quot;currentView=&apos;home&apos;&quot;&gt;home&lt;/li&gt;</div><div class="line">       &lt;li @click=&quot;currentView=&apos;list&apos;&quot;&gt;list&lt;/li&gt;</div><div class="line">       &lt;li @click=&quot;currentView=&apos;detail&apos;&quot;&gt;detail&lt;/li&gt;</div><div class="line">   &lt;/ul&gt;</div><div class="line">   &lt;component :is=&quot;currentView&quot;&gt;&lt;/component&gt;</div><div class="line">&lt;/div&gt;</div><div class="line"></div><div class="line">&lt;!--js--&gt;</div><div class="line">var vm = new Vue(&#123;</div><div class="line"> el:&quot;#app&quot;,</div><div class="line"> data:&#123;</div><div class="line">     currentView:&apos;home&apos;</div><div class="line"> &#125;,</div><div class="line"> components:&#123;</div><div class="line">     home:&#123;</div><div class="line">         template:&apos;&lt;div&gt;Home&lt;/div&gt;&apos;</div><div class="line">     &#125;,</div><div class="line">     list:&#123;</div><div class="line">         template:&apos;&lt;div&gt;List&lt;/div&gt;&apos;</div><div class="line">     &#125;,</div><div class="line">     detail:&#123;</div><div class="line">         template:&apos;&lt;div&gt;Detail&lt;/div&gt;&apos;</div><div class="line">     &#125;</div><div class="line"> &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</code></pre><ol>
<li><p>component 标签上is 属性决定了当前采用的子组件，:is 是v-bind:is 的缩写，绑定了父<br>组件中data 的currentView 属性。顶部的ul 则起到导航的作用，点击即可修改currentView<br>值，也就修改component 标签中使用的子组件类型。</p>
</li>
<li><p>需要注意的事，currentView 的值需要和父组件实例中的components属性的key相对应。</p>
</li>
</ol>
<h5 id="2-keep-alive"><a href="#2-keep-alive" class="headerlink" title="2.keep-alive"></a>2.keep-alive</h5><p>component 标签接受keep-alive 属性，可以将切换出去的组件保留在内存中，避免重新<br>渲染。我们将上述例子中的component 标签修改为：  </p>
<pre><code>&lt;component :is=&quot;currentView&quot; keep-alive&gt;&lt;/component&gt;

 home:{
         template:&apos;&lt;div&gt;&lt;p&gt;Home&lt;/p&gt;&lt;ul&gt;&lt;li v-for=&quot;item in items&quot;&gt;{{item}}&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;&apos;,
         data:function(){
             return{
                 items:[]
             }
         },
         ready:function(){
             console.log(&quot;ready&quot;);
             this.items=[1,2,3,4,5,6,7,8];
         }
     }
</code></pre><p>在keep-alive属性下可以在home和list之间切换currentView，home组件的ready 函数只运行一次，可以看到控制台只输出了一次“fetch data”。而将keep-alive 属性去除后，再次在home 和list 组件间切换，会发现每点击到home，控制台都会输出一次“ready”。我们可以根据该特性适当地进行页面的性能优化，如果每个组件在激活时并不要求每次都实时请求数据，那使用keep-alive 可以避免一些不必要的重复渲染，导致用户看到停留时间过长的空白页面。但如果每次激活组件都需要向后端请求数据的话，就不太适合使用keepalive属性了。</p>
<p>Vue.js 2.0 中keep-alive 属性被修改为标签，例如：</p>
<pre><code>&lt;keep-alive&gt;
　 &lt;component v-bind:is=&quot;view&quot;&gt;&lt;/component&gt;
&lt;/keep-alive&gt;
</code></pre><h5 id="3-activate钩子函数"><a href="#3-activate钩子函数" class="headerlink" title="3.activate钩子函数"></a>3.activate钩子函数</h5><p>1.Vue.js 给组件提供了activate 钩子函数，作用于动态组件切换或者静态组件初始化的过<br>程中<br>2.activate 接受一个回调函数做为参数，使用函数后组件才进行之后的渲染过程。<br>3.如下:  </p>
<pre><code>home:{
         template:&apos;&lt;div&gt;&lt;p&gt;Home&lt;/p&gt;&lt;ul&gt;&lt;li v-for=&quot;item in items&quot;&gt;{{item}}&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;&apos;,
         data:function(){
             return{
                 items:[]
             }
         },
        activate:function(done){
            var that = this;
            // 此处的setTimeout 用于模拟正式业务中的ajax 异步请求数据
            setTimeout(function() {
                that.items = [1, 2, 3, 4, 5];
                done();
            }, 1000);

        }
     }
</code></pre><p>此时也可以定义两个component 作为对比，并设定其中一个属性为keep-alive ：</p>
<pre><code>&lt;component :is=&quot;currentView&quot;&gt;&lt;/component&gt;
&lt;component :is=&quot;currentView&quot; keep-alive&gt;&lt;/component&gt;
</code></pre><p>可以对比出，再次激活home 后，未使用keep-alive 的component 会延迟1s 的时间才<br>渲染出列表。  </p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2017/11/10/vue-22-组件-动态组件/" class="archive-article-date">
  	<time datetime="2017-11-10T08:11:26.000Z" itemprop="datePublished"><i class="icon-clock"></i>2017-11-10</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Vue-js-前端开发-快速入门与专业应用/">Vue.js+前端开发+快速入门与专业应用</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-vue-21-组件-内容分发" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/11/10/vue-21-组件-内容分发/">vue(21)-组件-内容分发</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2017/11/10/vue-21-组件-内容分发/" class="archive-article-date">
  	<time datetime="2017-11-10T08:09:14.000Z" itemprop="datePublished"><i class="icon-clock"></i>2017-11-10</time>
</a>
      
      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-vue-20-组件-组件之间通信" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/11/05/vue-20-组件-组件之间通信/">vue(20)-组件-组件之间通信</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><ol>
<li>组件间通信是组件开发时非常重要的一环，我们既希望组件的独立性，数据能互不干涉,又不可避免组件间会有联系和交互。</li>
<li>Vue.js 在组件间通信这一部分既提供了:直接访问，自定义事件机制，通过广播、派发、监听等形式进行跨组件的函数调用。</li>
</ol>
<h4 id="内容"><a href="#内容" class="headerlink" title="内容"></a>内容</h4><h5 id="1-直接访问"><a href="#1-直接访问" class="headerlink" title="1.直接访问"></a>1.直接访问</h5><h5 id="2-自定义时间监听"><a href="#2-自定义时间监听" class="headerlink" title="2.自定义时间监听"></a>2.自定义时间监听</h5><p>在Vue 实例中，系统提供了一套自定义事件接口，用于组件间通信，方便修改组件状态。类似于在jQuery，我们给DOM 元素绑定一个非原生的事件，例如：$(‘#ele’).on(‘custom’,fn)，然后通过手动调用$(‘#ele’).trigger(‘custom’) 方式来进行事件的触发。 </p>
<h6 id="2-1-events选项"><a href="#2-1-events选项" class="headerlink" title="2.1 events选项"></a>2.1 events选项</h6><ol>
<li><p>我们可以在初始化实例或注册子组件的时候，直接传给选项events 一个对象.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">var vm = new Vue(&#123;</div><div class="line">   el:&quot;#app&quot;,</div><div class="line">   data:&#123;</div><div class="line">     todo:[]</div><div class="line">    &#125;,</div><div class="line">   events:&#123;</div><div class="line">     &apos;add&apos;:fucntion(msg)&#123;</div><div class="line">       this.todo.push(msg);</div><div class="line">      &#125;</div><div class="line">   &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
</ol>
<p>2.$on方法<br>我们也可以在某些特定情况或方法内采用$on 方法来监听事件，例如：</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">   var vm = new Vue(&#123;</div><div class="line">　 el : &apos;#app&apos;,</div><div class="line">　 data : &#123;</div><div class="line">　　 todo : []</div><div class="line">　 &#125;,</div><div class="line">　 methods : &#123;</div><div class="line">　　begin : function() &#123;</div><div class="line">　　　 this.$on(&apos;add&apos;, function(msg) &#123;</div><div class="line">　　　　　this.todo.push(msg);</div><div class="line">　　　 &#125;);</div><div class="line">　　&#125;</div><div class="line">　 &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</code></pre><h5 id="3-自定义事件触发机制"><a href="#3-自定义事件触发机制" class="headerlink" title="3.自定义事件触发机制"></a>3.自定义事件触发机制</h5><p>设置完成事件监听后，下面来看下Vue.js 的触发机制。  </p>
<h6 id="3-1．-emit"><a href="#3-1．-emit" class="headerlink" title="3.1．$emit"></a>3.1．$emit</h6><p>在实例本身上触发事件。例如：</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">    events : &#123;</div><div class="line">　&apos;add&apos; : function(msg) &#123;</div><div class="line">　　 this.todo.push(msg);</div><div class="line">　 &#125;</div><div class="line">&#125;</div><div class="line">methods: &#123;</div><div class="line">　 onClick : function() &#123;</div><div class="line">　　 this.$emit(&apos;add&apos;, &apos;there is a message&apos;);// 即可触发events 中的add 函数</div><div class="line">　 &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</code></pre><h6 id="3-2．-dispatch"><a href="#3-2．-dispatch" class="headerlink" title="3.2．$dispatch"></a>3.2．$dispatch</h6><p>派发事件，事件沿着父链冒泡，并且在第一次触发回调之后自动停止冒泡，除非触发函<br>数明确返回true，才会继续向上冒泡。  </p>
<p>父组件:  </p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">events : &#123;</div><div class="line">      &apos;add&apos; : function(msg) &#123;</div><div class="line">       this.todo.push(msg);</div><div class="line">      //return true　明确返回true 后，事件会继续向上冒泡</div><div class="line">      &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
</code></pre><p>子组件:</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">methods: &#123;</div><div class="line">  toParent : function() &#123;</div><div class="line">  this.$dispatch(&apos;add&apos;, &apos;message from child&apos;);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</code></pre><p>调用子组件中的toParent() 函数，即可向上冒泡，触发父组件中定义好的add 事件。</p>
<h6 id="3-3-broadcast"><a href="#3-3-broadcast" class="headerlink" title="3.3 $broadcast"></a>3.3 $broadcast</h6><p>广播事件，事件会向下传递给所有的后代。例如：</p>
<p>父组件:  </p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">methods: &#123; </div><div class="line">  toChild : function() &#123; </div><div class="line">  this.$dispatch(&apos;msg&apos;, &apos;message from parent&apos;);</div><div class="line"> &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</code></pre><p>子组件:  </p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">events : &#123;</div><div class="line">  &apos;msg&apos; : function(msg) &#123;</div><div class="line">   alert(msg);</div><div class="line">   &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
</code></pre><h6 id="3-4完整例子"><a href="#3-4完整例子" class="headerlink" title="3.4完整例子"></a>3.4完整例子</h6><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">   &lt;!DOCTYPE html&gt;</div><div class="line">&lt;html lang=&quot;en&quot;&gt;</div><div class="line">&lt;head&gt;</div><div class="line">   &lt;meta charset=&quot;UTF-8&quot;&gt;</div><div class="line">   &lt;title&gt;Title&lt;/title&gt;</div><div class="line">   &lt;script src=&quot;../js/vue.js&quot;&gt;&lt;/script&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">   &lt;div id = &quot;app&quot;&gt;</div><div class="line">      &lt;button v-on:click=&quot;addTo&quot;&gt;添加&lt;/button&gt;</div><div class="line">       &lt;input v-model=&quot;msg&quot;&gt;</div><div class="line">       &lt;ul&gt;</div><div class="line">           &lt;li v-for=&quot;items in arr&quot; track-by=&quot;$index&quot;&gt;</div><div class="line">               &#123;&#123;items&#125;&#125;</div><div class="line">           &lt;/li&gt;</div><div class="line">       &lt;/ul&gt;</div><div class="line">   &lt;/div&gt;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;script&gt;</div></pre></td></tr></table></figure>
</code></pre><p><img src="https://raw.githubusercontent.com/startshineye/img/master/2017/11/4.png" alt=""><br>在根实例的input 中输入内容“Hello”，点击“添加”， 即会在绑定v-for 指令的li 标签<br>中输出“Parent ：Hello”；或点击“广播”，则会输出“Child one: hello”和“Child two:<br>hello”两条数据，本质就是广播了事件to-child，两个子组件接受后触发了监听函数，将内<br>容和组件name 参数添加到父组件的todo 数组中。</p>
<h5 id="4-子组件索引"><a href="#4-子组件索引" class="headerlink" title="4.子组件索引"></a>4.子组件索引</h5><p>不建议组件间直接访问各自的实例，但有时也不可避免，Vue.js 也提供了直接<br>访问子组件的方式。除了之前的this.children 外，还可以给子组件绑定一个v-ref 指令，指<br>定一个索引ID，例如：</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">    　&lt;child-todo v-ref:first&gt;&lt;/child-todo&gt;</div></pre></td></tr></table></figure>
</code></pre><p>这样，在父组件中就可以通过this.$refs.first 的方式获取子组件实例。<br>如果v-ref 作用在v-for 绑定的元素上，例如：</p>
<pre><code>&lt;li v-for=&quot;item&quot; v-ref:items&gt;&lt;/li&gt;，
</code></pre><p>父组件获取的this.$refs.items 为一个数组，包含相应的子组件实例。</p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2017/11/05/vue-20-组件-组件之间通信/" class="archive-article-date">
  	<time datetime="2017-11-05T15:25:32.000Z" itemprop="datePublished"><i class="icon-clock"></i>2017-11-05</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Vue-js-前端开发-快速入门与专业应用/">Vue.js+前端开发+快速入门与专业应用</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/4/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/39/">39</a><a class="extend next" rel="next" href="/page/6/">Next &raquo;</a>
    </nav>
  


      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2018 Startshineye
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: "/",
		innerArchive: true
	}
</script>

<script src="/./main.js"></script>


    
<div class="tools-col">
  <ul class="btn-wrap">
    
      <li class="chose" data-hook="tools-section-all"><span class="text">全部</span><i class="icon-book"></i></li>
    
    
      <li data-hook="tools-section-tag"><span class="text">标签</span><i class="icon-price-tags"></i></li>
    
    
      <li data-hook="tools-section-friends"><span class="text">友链</span><i class="icon-link"></i></li>
    
    
      <li data-hook="tools-section-me"><span class="text">我</span><i class="icon-smile"></i></li>
    
  </ul>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all chose">
    	</section>
    

    
    	<section class="tools-section tools-section-tag">
    			<div class="widget tagcloud" id="js-tagcloud">
    				<a href="/tags/Android/" style="font-size: 20px;">Android</a> <a href="/tags/CTI/" style="font-size: 11.25px;">CTI</a> <a href="/tags/Cookie/" style="font-size: 10.63px;">Cookie</a> <a href="/tags/DevelopmentSkills/" style="font-size: 10px;">DevelopmentSkills</a> <a href="/tags/Easyui/" style="font-size: 10px;">Easyui</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/Github/" style="font-size: 10px;">Github</a> <a href="/tags/Http/" style="font-size: 10px;">Http</a> <a href="/tags/IE问题/" style="font-size: 10px;">IE问题</a> <a href="/tags/JDK/" style="font-size: 10px;">JDK</a> <a href="/tags/JSP/" style="font-size: 10px;">JSP</a> <a href="/tags/JVM/" style="font-size: 12.5px;">JVM</a> <a href="/tags/JavaSE/" style="font-size: 16.25px;">JavaSE</a> <a href="/tags/Jeecg/" style="font-size: 11.88px;">Jeecg</a> <a href="/tags/Maven/" style="font-size: 10px;">Maven</a> <a href="/tags/MongoDB/" style="font-size: 10px;">MongoDB</a> <a href="/tags/Myeclipse/" style="font-size: 15px;">Myeclipse</a> <a href="/tags/Netty/" style="font-size: 15.63px;">Netty</a> <a href="/tags/Node-js/" style="font-size: 10px;">Node.js</a> <a href="/tags/Oracle/" style="font-size: 17.5px;">Oracle</a> <a href="/tags/Redis/" style="font-size: 12.5px;">Redis</a> <a href="/tags/Servlet/" style="font-size: 11.88px;">Servlet</a> <a href="/tags/Spring/" style="font-size: 10.63px;">Spring</a> <a href="/tags/Spring-Boot/" style="font-size: 10px;">Spring Boot</a> <a href="/tags/SpringBoot/" style="font-size: 19.38px;">SpringBoot</a> <a href="/tags/SpringMVC/" style="font-size: 11.25px;">SpringMVC</a> <a href="/tags/Tomcat/" style="font-size: 10px;">Tomcat</a> <a href="/tags/Vue/" style="font-size: 18.75px;">Vue</a> <a href="/tags/Vue-js-前端开发-快速入门与专业应用/" style="font-size: 18.13px;">Vue.js+前端开发+快速入门与专业应用</a> <a href="/tags/Weblogic/" style="font-size: 12.5px;">Weblogic</a> <a href="/tags/Websocket/" style="font-size: 10.63px;">Websocket</a> <a href="/tags/Work-Problem/" style="font-size: 10px;">Work-Problem</a> <a href="/tags/dubbo/" style="font-size: 10px;">dubbo</a> <a href="/tags/easyui/" style="font-size: 10px;">easyui</a> <a href="/tags/hibernate/" style="font-size: 10.63px;">hibernate</a> <a href="/tags/html-css/" style="font-size: 10.63px;">html+css</a> <a href="/tags/html-css/" style="font-size: 16.25px;">html-css</a> <a href="/tags/html-ss/" style="font-size: 10px;">html-ss</a> <a href="/tags/im/" style="font-size: 14.38px;">im</a> <a href="/tags/jQuery/" style="font-size: 12.5px;">jQuery</a> <a href="/tags/java/" style="font-size: 10px;">java</a> <a href="/tags/java-String/" style="font-size: 10px;">java String</a> <a href="/tags/javaSE/" style="font-size: 10.63px;">javaSE</a> <a href="/tags/javaWeb/" style="font-size: 10px;">javaWeb</a> <a href="/tags/javascript/" style="font-size: 11.25px;">javascript</a> <a href="/tags/java并发编程/" style="font-size: 11.88px;">java并发编程</a> <a href="/tags/java集合/" style="font-size: 10.63px;">java集合</a> <a href="/tags/junit测试/" style="font-size: 10px;">junit测试</a> <a href="/tags/life/" style="font-size: 10px;">life</a> <a href="/tags/linux/" style="font-size: 15.63px;">linux</a> <a href="/tags/log4j/" style="font-size: 11.88px;">log4j</a> <a href="/tags/maven/" style="font-size: 10px;">maven</a> <a href="/tags/netty/" style="font-size: 11.88px;">netty</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/tags/nodeJs/" style="font-size: 10px;">nodeJs</a> <a href="/tags/redis/" style="font-size: 13.13px;">redis</a> <a href="/tags/servlet/" style="font-size: 10px;">servlet</a> <a href="/tags/sockJs/" style="font-size: 10px;">sockJs</a> <a href="/tags/socket网络编程/" style="font-size: 10.63px;">socket网络编程</a> <a href="/tags/struts1/" style="font-size: 11.25px;">struts1</a> <a href="/tags/vue/" style="font-size: 10.63px;">vue</a> <a href="/tags/web/" style="font-size: 10px;">web</a> <a href="/tags/weblogic/" style="font-size: 11.25px;">weblogic</a> <a href="/tags/websocket/" style="font-size: 11.25px;">websocket</a> <a href="/tags/work/" style="font-size: 10px;">work</a> <a href="/tags/代理/" style="font-size: 11.88px;">代理</a> <a href="/tags/前端/" style="font-size: 10.63px;">前端</a> <a href="/tags/动手写一个MVC/" style="font-size: 12.5px;">动手写一个MVC</a> <a href="/tags/反射/" style="font-size: 16.88px;">反射</a> <a href="/tags/异常/" style="font-size: 10px;">异常</a> <a href="/tags/微博/" style="font-size: 10px;">微博</a> <a href="/tags/文件读取/" style="font-size: 10px;">文件读取</a> <a href="/tags/泛型/" style="font-size: 13.75px;">泛型</a> <a href="/tags/注解/" style="font-size: 11.25px;">注解</a> <a href="/tags/类加载器/" style="font-size: 13.75px;">类加载器</a> <a href="/tags/线程/" style="font-size: 10px;">线程</a> <a href="/tags/自己写一个apache服务器/" style="font-size: 17.5px;">自己写一个apache服务器</a> <a href="/tags/转载/" style="font-size: 12.5px;">转载</a> <a href="/tags/集合/" style="font-size: 12.5px;">集合</a>
    			</div>
    	</section>
    

    
    	<section class="tools-section tools-section-friends">
  		
  			<div class="friends-wrap" id="js-friends">
  			
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.baidu.com/">baidu</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.jd.com/">jd</a>
  	        
  	        </div>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">毕业于&lt;br&gt;相信技术可以改变人与人之间的生活&lt;br&gt;码农一枚</div>
  	  	
    	</section>
    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>